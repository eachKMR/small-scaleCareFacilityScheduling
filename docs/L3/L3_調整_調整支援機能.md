# L3_調整_調整支援機能

**作成日**: 2025年11月23日  
**カテゴリ**: 第3層 - 統合設計  
**バージョン**: 1.0

---

## 📖 このドキュメントについて

このドキュメントは、**調整業務を支援する機能の設計**を定義します。

### 対象読者

- 調整支援機能の実装担当者
- ケアマネージャー・調整担当者
- プロジェクトマネージャー

### 読了後に理解できること

- 定員チェックの統合ロジック
- 空き状況検索機能
- 稼働率計算と可視化
- 予定変更の影響分析
- 利用パターン分析
- 警告・推奨機能

### 設計の前提

- **L0_業務_調整業務の制約.md** の調整業務の課題
- **L0_業務_定員の法的枠組み.md** の定員ルール
- **L2_通い_ロジック設計.md** の通い定員チェック
- **L2_泊まり_ロジック設計.md** の泊まり定員チェック
- **L1_データ_共通データ構造.md** のマスタデータ

---

## 1. 調整支援機能の全体像

### 1.1 機能マップ

```
調整支援機能
├─ 1. 定員チェック（リアルタイム）
│   ├─ 通い定員チェック（前半・後半）
│   ├─ 泊まり定員チェック
│   └─ 複合チェック（通い+泊まり）
│
├─ 2. 空き状況検索
│   ├─ 日別空き状況
│   ├─ 週別空き状況
│   ├─ 月間空き状況
│   └─ 条件指定検索
│
├─ 3. 稼働率分析
│   ├─ 登録率（29人中何人）
│   ├─ 通い稼働率（前半・後半）
│   ├─ 泊まり稼働率
│   └─ 月間推移
│
├─ 4. 予定変更の影響分析
│   ├─ 定員への影響
│   ├─ 他利用者への影響
│   └─ 居室割当への影響
│
├─ 5. 利用パターン分析
│   ├─ 利用者別の利用頻度
│   ├─ サービス別の利用傾向
│   └─ 曜日・時期別の傾向
│
└─ 6. 警告・推奨機能
    ├─ 定員超過警告
    ├─ 連続宿泊の警告
    ├─ 空き枠の推奨
    └─ 最適化の提案
```

---

### 1.2 Phase別実装

| Phase | 実装機能 |
|-------|---------|
| **Phase 1** | 定員チェック、空き状況検索、基本的な稼働率表示 |
| **Phase 2** | 影響分析、利用パターン分析、警告機能の拡充 |
| **Phase 3** | AI推奨、最適化提案、予測機能 |

---

## 2. 定員チェック（統合ロジック）

### 2.1 3サービスの定員チェック統合

#### 2.1.1 概要

（実装詳細は後で追加）

---

### 2.2 リアルタイム定員チェック

#### 2.2.1 イベント駆動型チェック

（実装詳細は後で追加）

---

### 2.3 複合チェック（通い+泊まり）

#### 2.3.1 同日の通いと泊まり

（実装詳細は後で追加）

---

## 3. 空き状況検索

### 3.1 日別空き状況

#### 3.1.1 データ構造

（実装詳細は後で追加）

---

### 3.2 条件指定検索

#### 3.2.1 検索条件

（実装詳細は後で追加）

---

### 3.3 空き枠の可視化

#### 3.3.1 カレンダー表示

（実装詳細は後で追加）

---

## 4. 稼働率分析

### 4.1 登録率

#### 4.1.1 計算方法

（実装詳細は後で追加）

---

### 4.2 通い稼働率

#### 4.2.1 前半・後半別の稼働率

（実装詳細は後で追加）

---

### 4.3 泊まり稼働率

#### 4.3.1 日別・月別の稼働率

（実装詳細は後で追加）

---

### 4.4 月間推移

#### 4.4.1 グラフ表示

（実装詳細は後で追加）

---

## 5. 予定変更の影響分析

### 5.1 定員への影響

#### 5.1.1 変更前後の定員比較

（実装詳細は後で追加）

---

### 5.2 他利用者への影響

#### 5.2.1 連鎖的な変更の検出

（実装詳細は後で追加）

---

### 5.3 居室割当への影響

#### 5.3.1 泊まり予定変更時の居室調整

（実装詳細は後で追加）

---

## 6. 利用パターン分析

### 6.1 利用者別の利用頻度

#### 6.1.1 サービス別集計

（実装詳細は後で追加）

---

### 6.2 サービス別の利用傾向

#### 6.2.1 通い・訪問・泊まりの比率

（実装詳細は後で追加）

---

### 6.3 曜日・時期別の傾向

#### 6.3.1 曜日パターンの分析

（実装詳細は後で追加）

---

## 7. 警告・推奨機能

### 7.1 定員超過警告

#### 7.1.1 警告タイミング

（実装詳細は後で追加）

---

### 7.2 連続宿泊の警告

#### 7.2.1 長期宿泊の検出

（実装詳細は後で追加）

---

### 7.3 空き枠の推奨

#### 7.3.1 代替日の提案

（実装詳細は後で追加）

---

### 7.4 最適化の提案（Phase 3）

#### 7.4.1 AI推奨アルゴリズム

（実装詳細は後で追加）

---

## 8. データ集計・キャッシュ戦略

### 8.1 集計データの管理

#### 8.1.1 キャッシュ戦略

（実装詳細は後で追加）

---

### 8.2 パフォーマンス最適化

#### 8.2.1 遅延計算

（実装詳細は後で追加）

---

## 9. まとめ

### 9.1 このドキュメントで定義したこと

```
✅ 定義したこと（アウトライン）
├─ 調整支援機能の全体像
├─ 定員チェックの統合方針
├─ 空き状況検索の構造
├─ 稼働率分析の項目
├─ 予定変更の影響分析
├─ 利用パターン分析
└─ 警告・推奨機能
```

---

### 9.2 重要なポイント

1. **統合ロジック**: 3サービスの定員チェックを統合管理
2. **リアルタイム**: イベント駆動でリアルタイムに状況を更新
3. **可視化**: 稼働率・空き状況を分かりやすく表示
4. **影響分析**: 予定変更が他に与える影響を事前に把握
5. **段階的実装**: Phase 1で基本機能、Phase 2-3で高度な機能

---

### 9.3 Phase 1で実装すること

```
✅ Phase 1
├─ 定員チェック（統合）
├─ 空き状況検索（日別・週別）
├─ 稼働率表示（基本）
└─ 定員超過警告

⏭️ Phase 2以降
├─ 影響分析
├─ 利用パターン分析
├─ 高度な警告機能
└─ AI推奨（Phase 3）
```

---

### 9.4 次のステップ

調整支援機能のアウトラインが完成しました。

**次に行うこと**:
- 各セクションの詳細実装内容を追加
- コード例の記述
- テスト仕様の追加

---

## 📚 次に読むべきドキュメント

このドキュメントを読了したら、以下のドキュメントに進んでください。

### 関連ドキュメント

- **L0_業務_調整業務の制約.md** - 調整業務の課題と背景
- **L2_通い_ロジック設計.md** - 通い定員チェックの詳細
- **L2_泊まり_ロジック設計.md** - 泊まり定員チェックの詳細
- **L1_データ_共通データ構造.md** - マスタデータ構造

---

## 📝 参考資料

- L0_業務_定員の法的枠組み.md（定員の法的根拠）
- L0_業務_新規利用者獲得.md（稼働率向上の観点）

---

## 📅 更新履歴

| 日付 | バージョン | 変更内容 | 担当 |
|------|----------|---------|------|
| 2025-11-23 | 1.0 | アウトライン作成 | Claude |

---

**最終更新**: 2025年11月23日  
**次回更新予定**: 詳細実装内容の追加時

---

## ⚠️ 設計チェックリスト

このドキュメントの品質チェック：

- [x] 機能の全体像が明確
- [ ] 定員チェックの実装が具体的（詳細追加予定）
- [ ] 空き状況検索の実装が具体的（詳細追加予定）
- [ ] 稼働率分析の実装が具体的（詳細追加予定）
- [ ] 影響分析の実装が具体的（詳細追加予定）
- [ ] 警告機能の実装が具体的（詳細追加予定）
- [x] Phase別の実装計画が明確

---

**このドキュメントのアウトラインを確認後、詳細実装内容を追加していきます。**
