# L2_é€šã„_ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

**ä½œæˆæ—¥**: 2025å¹´11æœˆ23æ—¥  
**ã‚«ãƒ†ã‚´ãƒª**: ç¬¬2å±¤ - ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 4.0  
**æ›´æ–°æ—¥**: 2025å¹´12æœˆ19æ—¥

---

## ğŸ“– ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€**é€šã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ **ã‚’å®šç¾©ã—ã¾ã™ã€‚

### v4.0ã§ã®ä¸»è¦ãªå¤‰æ›´

1. **é€šã„è¨˜å·ã®ç°¡ç•¥åŒ–**
   - å‰åŠï¼ˆâ—“ï¼‰ãƒ»å¾ŒåŠï¼ˆâ—’ï¼‰ã‚’å‰Šé™¤
   - çµ‚æ—¥ï¼ˆâ—‹ï¼‰ã®ã¿ã‚’ä½¿ç”¨
   - ãŸã ã—ã€å‰åŠãƒ»å¾ŒåŠã¯å¼•ãç¶šãåˆ©ç”¨å¯èƒ½ï¼ˆåˆ©ç”¨è€…è¨­å®šã§ï¼‰

2. **æ³Šã¾ã‚ŠæœŸé–“ã®çµ±åˆç®¡ç†**
   - é€šã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§æ³Šã¾ã‚ŠæœŸé–“ã‚‚è¡¨ç¤º
   - ç½«ç·šï¼ˆé’/è–„é’ï¼‰ã§æ³Šã¾ã‚Šã‚’è¡¨ç¾
   - æ³Šã¾ã‚ŠæœŸé–“å†…ã¯è‡ªå‹•çš„ã«â—‹ãŒä»˜ã

3. **ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å¤‰æ›´**
   - åˆ©ç”¨è€…ã”ã¨ã«æ³Šã¾ã‚ŠæœŸé–“ã‚’ç®¡ç†
   - å„æ—¥ã®é€šã„æƒ…å ±ã¯æ˜ç¤ºçš„ã«è¨­å®šã•ã‚ŒãŸå ´åˆã®ã¿è¨˜éŒ²

### å¯¾è±¡èª­è€…

- é€šã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å®Ÿè£…æ‹…å½“è€…
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ‹…å½“è€…
- ãƒ†ã‚¹ãƒˆæ‹…å½“è€…

### èª­äº†å¾Œã«ç†è§£ã§ãã‚‹ã“ã¨

- é€šã„ã¨æ³Šã¾ã‚Šã®çµ±åˆãƒ‡ãƒ¼ã‚¿æ§‹é€ 
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆâ—‹ã®è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«
- å‹å¤‰æ›ã®è²¬ä»»åˆ†æ‹…

---

## 1. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«æ¦‚è¦

### 1.1 è²¬å‹™

**é€šã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒç®¡ç†ã™ã‚‹ãƒ‡ãƒ¼ã‚¿**:
- åˆ©ç”¨è€…ã”ã¨ã®é€šã„ã‚µãƒ¼ãƒ“ã‚¹ã®äºˆå®š
- **åˆ©ç”¨è€…ã”ã¨ã®æ³Šã¾ã‚ŠæœŸé–“**ï¼ˆé‡ã®èª¿æ•´ç”¨ï¼‰
- å®šå“¡ç®¡ç†ï¼ˆçµ‚æ—¥ã®ã¿ã€å‰åŠå¾ŒåŠã®åŒºåˆ¥ãªã—ï¼‰

**é‡è¦**: æ³Šã¾ã‚Šã®ã€Œå±…å®¤å‰²ã‚Šå½“ã¦ã€ã¯æ³Šã¾ã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è²¬ä»»

---

### 1.2 ãƒ‡ãƒ¼ã‚¿ã®ç²’åº¦

#### é€šã„æƒ…å ±

```
1ãƒ¬ã‚³ãƒ¼ãƒ‰ = 1äºº Ã— 1æ—¥ Ã— é€šã„æƒ…å ±

ãŸã ã—ã€æ³Šã¾ã‚ŠæœŸé–“å†…ã§kayoiãŒnullã®å ´åˆã¯
ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œã‚‰ãšã€è¡¨ç¤ºæ™‚ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆâ—‹ã‚’è¡¨ç¤º
```

**ä¾‹**:
```javascript
// å®‰è—¤ã•ã‚“ãŒ11æœˆ25æ—¥ã«çµ‚æ—¥åˆ©ç”¨ï¼ˆæ³Šã¾ã‚Šãªã—ï¼‰
{
  userId: "user001",
  date: "2025-11-25",
  kayoi: "çµ‚æ—¥"
}

// å®‰è—¤ã•ã‚“ãŒ11æœˆ26æ—¥ã«å‰åŠã®ã¿åˆ©ç”¨ï¼ˆæ³Šã¾ã‚Šãªã—ï¼‰
{
  userId: "user001",
  date: "2025-11-26",
  kayoi: "å‰åŠ"
}
```

#### æ³Šã¾ã‚Šæƒ…å ±

```
1ãƒ¬ã‚³ãƒ¼ãƒ‰ = 1äºº Ã— 1æ³Šã¾ã‚ŠæœŸé–“
```

**ä¾‹**:
```javascript
// å®‰è—¤ã•ã‚“ãŒ11æœˆ15æ—¥ã€œ18æ—¥ã«æ³Šã¾ã‚Š
{
  userId: "user001",
  tomariPeriod: {
    checkInDate: "2025-11-15",
    checkOutDate: "2025-11-18"
  }
}
```

---

### 1.3 æœˆåˆ¥äºˆå®šè¡¨ã¨ã®å¯¾å¿œ

```
æœˆåˆ¥äºˆå®šè¡¨ï¼ˆæ¨ªè»¸: æ—¥ä»˜ã€ç¸¦è»¸: åˆ©ç”¨è€…ï¼‰

        25æ—¥  26æ—¥  27æ—¥  28æ—¥
å®‰è—¤    â—‹    â—“    â—’    â—‹
        â”â”  â”â”  â”â”  â”â”
        é’  é’  é’  è–„é’

â—‹ = çµ‚æ—¥é€šã„
â—“ = å‰åŠã®ã¿é€šã„
â—’ = å¾ŒåŠã®ã¿é€šã„
â”â” = ç½«ç·šï¼ˆé’=å…¥æ‰€ãƒ»é€£æ³Šã€è–„é’=é€€æ‰€ï¼‰
```

**ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ã®è¡¨ç¾**:
```javascript
{
  userId: "user001",
  
  // æ³Šã¾ã‚ŠæœŸé–“
  tomariPeriod: {
    checkInDate: "2025-11-25",
    checkOutDate: "2025-11-28"
  },
  
  // é€šã„æƒ…å ±ï¼ˆæ˜ç¤ºçš„ã«è¨­å®šã•ã‚ŒãŸå ´åˆã®ã¿ï¼‰
  kayoiSchedule: {
    // 25æ—¥: nullï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆâ—‹ï¼‰
    "2025-11-26": "å‰åŠ",  // æ˜ç¤ºçš„ã«å‰åŠã«å¤‰æ›´
    "2025-11-27": "å¾ŒåŠ"   // æ˜ç¤ºçš„ã«å¾ŒåŠã«å¤‰æ›´
    // 28æ—¥: nullï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆâ—‹ï¼‰
  }
}
```

**è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯**:
- 25æ—¥: æ³Šã¾ã‚ŠæœŸé–“å†… + kayoi null â†’ â—‹ã‚’è¡¨ç¤º
- 26æ—¥: æ³Šã¾ã‚ŠæœŸé–“å†… + kayoi "å‰åŠ" â†’ â—“ã‚’è¡¨ç¤º
- 27æ—¥: æ³Šã¾ã‚ŠæœŸé–“å†… + kayoi "å¾ŒåŠ" â†’ â—’ã‚’è¡¨ç¤º
- 28æ—¥: æ³Šã¾ã‚ŠæœŸé–“å†… + kayoi null â†’ â—‹ã‚’è¡¨ç¤º

---

## 2. ãƒ‡ãƒ¼ã‚¿æ§‹é€ å®šç¾©

### 2.1 åˆ©ç”¨è€…ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

#### UserScheduleData ã‚¯ãƒ©ã‚¹

| ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å | å‹ | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜ |
|------------|----|----|----------|------|
| **userId** | `string` | âœ“ | - | åˆ©ç”¨è€…IDï¼ˆä¾‹: `"user001"`ï¼‰ |
| **tomariPeriod** | `TomariPeriod \| null` | - | `null` | æ³Šã¾ã‚ŠæœŸé–“ |
| **kayoiSchedule** | `Map<string, KayoiType>` | âœ“ | `{}` | æ—¥ä»˜ã”ã¨ã®é€šã„æƒ…å ± |
| **updatedAt** | `string` | âœ“ | è‡ªå‹•ç”Ÿæˆ | æ›´æ–°æ—¥æ™‚ï¼ˆISOå½¢å¼ï¼‰ |

---

#### TomariPeriodï¼ˆæ³Šã¾ã‚ŠæœŸé–“ï¼‰

| ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å | å‹ | å¿…é ˆ | èª¬æ˜ |
|------------|----|----|------|
| **checkInDate** | `string` | âœ“ | å…¥æ‰€æ—¥ï¼ˆ`"YYYY-MM-DD"` å½¢å¼ï¼‰ |
| **checkOutDate** | `string` | âœ“ | é€€æ‰€æ—¥ï¼ˆ`"YYYY-MM-DD"` å½¢å¼ï¼‰ |

---

#### KayoiTypeï¼ˆé€šã„æƒ…å ±ï¼‰

```typescript
type KayoiType = null | "çµ‚æ—¥" | "å‰åŠ" | "å¾ŒåŠ";
```

| å€¤ | æ„å‘³ | è¨˜å· | ä½¿ç”¨é »åº¦ |
|----|----|------|---------|
| `null` | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆæ³Šã¾ã‚ŠæœŸé–“å†…ãªã‚‰â—‹ï¼‰ | â—‹ | é«˜ |
| `"çµ‚æ—¥"` | æ˜ç¤ºçš„ãªçµ‚æ—¥é€šã„ | â—‹ | é«˜ |
| `"å‰åŠ"` | åˆå‰ã®ã¿é€šã„ | â—“ | ä½ |
| `"å¾ŒåŠ"` | åˆå¾Œã®ã¿é€šã„ | â—’ | ä½ |

**é‡è¦ãªä»•æ§˜**:
- **æ³Šã¾ã‚ŠæœŸé–“å†…ã§kayoiãŒnull â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆâ—‹ã‚’è¡¨ç¤º**
- **æ³Šã¾ã‚ŠæœŸé–“å¤–ã§kayoiãŒnull â†’ ç©ºæ¬„ã‚’è¡¨ç¤º**
- æ˜ç¤ºçš„ã«è¨­å®šã•ã‚ŒãŸkayoiå€¤ã¯å¸¸ã«ãã®é€šã‚Šã«è¡¨ç¤º

---

### 2.2 å…·ä½“ä¾‹

#### ä¾‹1ï¼šæ³Šã¾ã‚Šã®ã¿ï¼ˆæ—¥ä¸­ã¯è‡ªå®…ï¼‰

```javascript
{
  userId: "user001",
  tomariPeriod: {
    checkInDate: "2025-11-15",
    checkOutDate: "2025-11-18"
  },
  kayoiSchedule: {
    "2025-11-15": null,  // ç©ºæ¬„ã«æ˜ç¤ºçš„ã«å¤‰æ›´
    "2025-11-16": null,  // ç©ºæ¬„ã«æ˜ç¤ºçš„ã«å¤‰æ›´
    "2025-11-17": null,  // ç©ºæ¬„ã«æ˜ç¤ºçš„ã«å¤‰æ›´
    "2025-11-18": null   // ç©ºæ¬„ã«æ˜ç¤ºçš„ã«å¤‰æ›´
  }
}
```

**è¡¨ç¤º**:
```
        15  16  17  18
user001  -   -   -   -
        â”â”  â”â”  â”â”  â”â”
        é’  é’  é’  è–„é’
```

**æ³¨æ„**: æ³Šã¾ã‚ŠæœŸé–“å†…ã§é€šã„ã‚’ç©ºæ¬„ã«ã™ã‚‹å ´åˆã€æ˜ç¤ºçš„ã«nullã‚’è¨­å®šã—ã€ãã®å¾Œã®çŸ­æŠ¼ã—ã§ç©ºæ¬„ã«å¤‰æ›´ã™ã‚‹ã€‚

---

#### ä¾‹2ï¼šæ³Šã¾ã‚Š+é€šã„ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰

```javascript
{
  userId: "user001",
  tomariPeriod: {
    checkInDate: "2025-11-15",
    checkOutDate: "2025-11-18"
  },
  kayoiSchedule: {
    // ã™ã¹ã¦nullï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆâ—‹ï¼‰
  }
}
```

**è¡¨ç¤º**:
```
        15  16  17  18
user001  â—‹  â—‹  â—‹  â—‹
        â”â”  â”â”  â”â”  â”â”
        é’  é’  é’  è–„é’
```

---

#### ä¾‹3ï¼šæ³Šã¾ã‚Š+é€šã„ï¼ˆä¸€éƒ¨å¤‰æ›´ï¼‰

```javascript
{
  userId: "user001",
  tomariPeriod: {
    checkInDate: "2025-11-15",
    checkOutDate: "2025-11-18"
  },
  kayoiSchedule: {
    "2025-11-16": "å‰åŠ",  // åˆå¾Œã®ã¿è‡ªå®…
    "2025-11-17": "å¾ŒåŠ"   // åˆå‰ã®ã¿è‡ªå®…
  }
}
```

**è¡¨ç¤º**:
```
        15  16  17  18
user001  â—‹  â—“  â—’  â—‹
        â”â”  â”â”  â”â”  â”â”
        é’  é’  é’  è–„é’
```

---

### 2.3 å‹ã«é–¢ã™ã‚‹é‡è¦ãªæ³¨æ„

#### æ—¥ä»˜ã¯æ–‡å­—åˆ—

**æ—¥ä»˜ã¯æ–‡å­—åˆ—ï¼ˆ"YYYY-MM-DD"ï¼‰ã‚’ä½¿ç”¨**

```javascript
âœ… æ­£ã—ã„
const tomariPeriod = {
  checkInDate: "2025-11-15",
  checkOutDate: "2025-11-18"
};

âŒ é–“é•ã„
const tomariPeriod = {
  checkInDate: new Date("2025-11-15"),  // Dateå‹ã¯ä½¿ã‚ãªã„
  checkOutDate: new Date("2025-11-18")
};
```

**ç†ç”±**:
- L1_æŠ€è¡“_å®Ÿè£…åˆ¶ç´„.md ã®ã€Œ1.1 æ—¥ä»˜ã®æ‰±ã„ã€ã«æº–æ‹ 
- HTMLã®`data-date`å±æ€§ã¨ã®æ¯”è¼ƒãŒå®¹æ˜“
- ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®å•é¡Œã‚’å›é¿

---

## 3. è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯

### 3.1 ã‚»ãƒ«ã®è¡¨ç¤ºè¨˜å·ã‚’æ±ºå®šã™ã‚‹é–¢æ•°

```javascript
/**
 * ã‚»ãƒ«ã«è¡¨ç¤ºã™ã‚‹è¨˜å·ã‚’å–å¾—
 * @param {UserScheduleData} userData - åˆ©ç”¨è€…ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿
 * @param {string} date - æ—¥ä»˜ï¼ˆYYYY-MM-DDï¼‰
 * @returns {string} è¡¨ç¤ºè¨˜å·ï¼ˆ"", "â—‹", "â—“", "â—’"ï¼‰
 */
function getDisplaySymbol(userData, date) {
  // æ³Šã¾ã‚ŠæœŸé–“å†…ã‹ãƒã‚§ãƒƒã‚¯
  const isInTomariPeriod = userData.tomariPeriod && 
    date >= userData.tomariPeriod.checkInDate && 
    date <= userData.tomariPeriod.checkOutDate;
  
  // æ˜ç¤ºçš„ãªkayoiè¨­å®šã‚’ç¢ºèª
  const kayoi = userData.kayoiSchedule[date];
  
  // ã‚±ãƒ¼ã‚¹1: æ˜ç¤ºçš„ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
  if (kayoi === "çµ‚æ—¥") return "â—‹";
  if (kayoi === "å‰åŠ") return "â—“";
  if (kayoi === "å¾ŒåŠ") return "â—’";
  if (kayoi === null && !isInTomariPeriod) return "";  // æ˜ç¤ºçš„ã«ç©ºæ¬„
  
  // ã‚±ãƒ¼ã‚¹2: æ³Šã¾ã‚ŠæœŸé–“å†…ã§kayoiæœªè¨­å®š â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆâ—‹
  if (isInTomariPeriod && kayoi === undefined) {
    return "â—‹";
  }
  
  // ã‚±ãƒ¼ã‚¹3: ãã®ä»– â†’ ç©ºæ¬„
  return "";
}
```

---

### 3.2 ç½«ç·šã®çŠ¶æ…‹ã‚’æ±ºå®šã™ã‚‹é–¢æ•°

```javascript
/**
 * ã‚»ãƒ«ã®ç½«ç·šçŠ¶æ…‹ã‚’å–å¾—
 * @param {UserScheduleData} userData - åˆ©ç”¨è€…ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿
 * @param {string} date - æ—¥ä»˜ï¼ˆYYYY-MM-DDï¼‰
 * @returns {string} ç½«ç·šçŠ¶æ…‹ï¼ˆ"none", "stay", "checkout"ï¼‰
 */
function getBorderState(userData, date) {
  if (!userData.tomariPeriod) return "none";
  
  const { checkInDate, checkOutDate } = userData.tomariPeriod;
  
  // å…¥æ‰€æ—¥ã€œé€€æ‰€æ—¥å‰æ—¥: é’ç½«ç·šï¼ˆstayï¼‰
  if (date >= checkInDate && date < checkOutDate) {
    return "stay";
  }
  
  // é€€æ‰€æ—¥: è–„é’ç½«ç·šï¼ˆcheckoutï¼‰
  if (date === checkOutDate) {
    return "checkout";
  }
  
  return "none";
}
```

---

### 3.3 CSSé©ç”¨ä¾‹

```css
/* é€šå¸¸ã®ç½«ç·š */
.schedule-cell {
  border-bottom: 1px solid #ddd;
}

/* å…¥æ‰€ãƒ»é€£æ³Šï¼ˆé’ï¼‰ */
.schedule-cell.tomari-stay {
  border-bottom: 4px solid #2196f3;
}

/* é€€æ‰€ï¼ˆè–„é’ï¼‰ */
.schedule-cell.tomari-checkout {
  border-bottom: 4px solid rgba(33, 150, 243, 0.3);
}
```

---

## 4. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

### 4.1 æ³Šã¾ã‚ŠæœŸé–“ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```javascript
/**
 * æ³Šã¾ã‚ŠæœŸé–“ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
 * @param {TomariPeriod} tomariPeriod - æ³Šã¾ã‚ŠæœŸé–“
 * @returns {Object} { valid: boolean, errors: string[] }
 */
function validateTomariPeriod(tomariPeriod) {
  const errors = [];
  
  if (!tomariPeriod) {
    return { valid: true, errors: [] };  // null ã¯æœ‰åŠ¹
  }
  
  // å¿…é ˆãƒã‚§ãƒƒã‚¯
  if (!tomariPeriod.checkInDate) {
    errors.push('å…¥æ‰€æ—¥ã¯å¿…é ˆã§ã™');
  }
  if (!tomariPeriod.checkOutDate) {
    errors.push('é€€æ‰€æ—¥ã¯å¿…é ˆã§ã™');
  }
  
  // å½¢å¼ãƒã‚§ãƒƒã‚¯
  const datePattern = /^\d{4}-\d{2}-\d{2}$/;
  if (tomariPeriod.checkInDate && !datePattern.test(tomariPeriod.checkInDate)) {
    errors.push('å…¥æ‰€æ—¥ã®å½¢å¼ãŒä¸æ­£ã§ã™ï¼ˆYYYY-MM-DDï¼‰');
  }
  if (tomariPeriod.checkOutDate && !datePattern.test(tomariPeriod.checkOutDate)) {
    errors.push('é€€æ‰€æ—¥ã®å½¢å¼ãŒä¸æ­£ã§ã™ï¼ˆYYYY-MM-DDï¼‰');
  }
  
  // è«–ç†ãƒã‚§ãƒƒã‚¯
  if (tomariPeriod.checkInDate && tomariPeriod.checkOutDate) {
    if (tomariPeriod.checkInDate > tomariPeriod.checkOutDate) {
      errors.push('å…¥æ‰€æ—¥ã¯é€€æ‰€æ—¥ã‚ˆã‚Šå‰ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
    }
    
    // æœ€ä½1æ³Š
    if (tomariPeriod.checkInDate === tomariPeriod.checkOutDate) {
      errors.push('æœ€ä½1æ³Šå¿…è¦ã§ã™');
    }
  }
  
  return {
    valid: errors.length === 0,
    errors: errors
  };
}
```

---

### 4.2 é€šã„æƒ…å ±ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```javascript
/**
 * é€šã„æƒ…å ±ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
 * @param {string} date - æ—¥ä»˜
 * @param {KayoiType} kayoi - é€šã„æƒ…å ±
 * @returns {Object} { valid: boolean, errors: string[] }
 */
function validateKayoi(date, kayoi) {
  const errors = [];
  
  // æ—¥ä»˜ã®å½¢å¼ãƒã‚§ãƒƒã‚¯
  const datePattern = /^\d{4}-\d{2}-\d{2}$/;
  if (!datePattern.test(date)) {
    errors.push('æ—¥ä»˜ã®å½¢å¼ãŒä¸æ­£ã§ã™ï¼ˆYYYY-MM-DDï¼‰');
  }
  
  // kayoiã®å€¤ãƒã‚§ãƒƒã‚¯
  const validKayoiValues = [null, "çµ‚æ—¥", "å‰åŠ", "å¾ŒåŠ"];
  if (!validKayoiValues.includes(kayoi)) {
    errors.push('é€šã„æƒ…å ±ã®å€¤ãŒä¸æ­£ã§ã™');
  }
  
  return {
    valid: errors.length === 0,
    errors: errors
  };
}
```

---

## 5. ãƒ‡ãƒ¼ã‚¿æ“ä½œ

### 5.1 æ³Šã¾ã‚ŠæœŸé–“ã®è¨­å®š

```javascript
/**
 * æ³Šã¾ã‚ŠæœŸé–“ã‚’è¨­å®š
 * @param {UserScheduleData} userData - åˆ©ç”¨è€…ãƒ‡ãƒ¼ã‚¿
 * @param {string} checkInDate - å…¥æ‰€æ—¥
 * @param {string} checkOutDate - é€€æ‰€æ—¥
 * @returns {Object} { success: boolean, errors?: string[] }
 */
function setTomariPeriod(userData, checkInDate, checkOutDate) {
  const tomariPeriod = { checkInDate, checkOutDate };
  
  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const validation = validateTomariPeriod(tomariPeriod);
  if (!validation.valid) {
    return { success: false, errors: validation.errors };
  }
  
  // è¨­å®š
  userData.tomariPeriod = tomariPeriod;
  userData.updatedAt = new Date().toISOString();
  
  // ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
  dispatchEvent(new CustomEvent('tomari:periodSet', {
    detail: { userId: userData.userId, tomariPeriod }
  }));
  
  return { success: true };
}
```

---

### 5.2 æ³Šã¾ã‚ŠæœŸé–“ã®å‰Šé™¤

```javascript
/**
 * æ³Šã¾ã‚ŠæœŸé–“ã‚’å‰Šé™¤
 * @param {UserScheduleData} userData - åˆ©ç”¨è€…ãƒ‡ãƒ¼ã‚¿
 * @returns {Object} { success: boolean }
 */
function clearTomariPeriod(userData) {
  if (!userData.tomariPeriod) {
    return { success: true };  // æ—¢ã«ãªã—
  }
  
  const oldPeriod = userData.tomariPeriod;
  
  // æ³Šã¾ã‚ŠæœŸé–“ã‚’å‰Šé™¤
  userData.tomariPeriod = null;
  
  // æ³Šã¾ã‚ŠæœŸé–“å†…ã®é€šã„æƒ…å ±ã‚‚å‰Šé™¤
  if (oldPeriod) {
    const { checkInDate, checkOutDate } = oldPeriod;
    for (let date = checkInDate; date <= checkOutDate; date = nextDate(date)) {
      delete userData.kayoiSchedule[date];
    }
  }
  
  userData.updatedAt = new Date().toISOString();
  
  // ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
  dispatchEvent(new CustomEvent('tomari:periodCleared', {
    detail: { userId: userData.userId }
  }));
  
  return { success: true };
}
```

---

### 5.3 é€šã„æƒ…å ±ã®è¨­å®š

```javascript
/**
 * é€šã„æƒ…å ±ã‚’è¨­å®š
 * @param {UserScheduleData} userData - åˆ©ç”¨è€…ãƒ‡ãƒ¼ã‚¿
 * @param {string} date - æ—¥ä»˜
 * @param {KayoiType} kayoi - é€šã„æƒ…å ±
 * @returns {Object} { success: boolean, errors?: string[] }
 */
function setKayoi(userData, date, kayoi) {
  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const validation = validateKayoi(date, kayoi);
  if (!validation.valid) {
    return { success: false, errors: validation.errors };
  }
  
  // è¨­å®š
  if (kayoi === null || kayoi === undefined) {
    // nullã¾ãŸã¯undefinedãªã‚‰å‰Šé™¤ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™ï¼‰
    delete userData.kayoiSchedule[date];
  } else {
    userData.kayoiSchedule[date] = kayoi;
  }
  
  userData.updatedAt = new Date().toISOString();
  
  // ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
  dispatchEvent(new CustomEvent('kayoi:updated', {
    detail: { userId: userData.userId, date, kayoi }
  }));
  
  return { success: true };
}
```

---

## 6. å‹å¤‰æ›

### 6.1 JSON â‡” ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

#### ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ â†’ JSONï¼‰

```javascript
function toJSON(userData) {
  return {
    userId: userData.userId,
    tomariPeriod: userData.tomariPeriod,
    kayoiSchedule: Object.fromEntries(
      Object.entries(userData.kayoiSchedule)
    ),
    updatedAt: userData.updatedAt
  };
}
```

#### ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆJSON â†’ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰

```javascript
function fromJSON(json) {
  return {
    userId: json.userId,
    tomariPeriod: json.tomariPeriod || null,
    kayoiSchedule: json.kayoiSchedule || {},
    updatedAt: json.updatedAt
  };
}
```

---

### 6.2 CSVå¤‰æ›

#### ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿ â†’ CSVï¼‰

```javascript
function exportToCSV(allUserData) {
  const rows = [];
  
  for (const userData of allUserData) {
    // æ³Šã¾ã‚ŠæœŸé–“ã®è¡Œ
    if (userData.tomariPeriod) {
      rows.push({
        åˆ©ç”¨è€…ID: userData.userId,
        ç¨®åˆ¥: 'æ³Šã¾ã‚Š',
        é–‹å§‹æ—¥: userData.tomariPeriod.checkInDate,
        çµ‚äº†æ—¥: userData.tomariPeriod.checkOutDate
      });
    }
    
    // é€šã„æƒ…å ±ã®è¡Œ
    for (const [date, kayoi] of Object.entries(userData.kayoiSchedule)) {
      rows.push({
        åˆ©ç”¨è€…ID: userData.userId,
        ç¨®åˆ¥: 'é€šã„',
        æ—¥ä»˜: date,
        å†…å®¹: kayoi
      });
    }
  }
  
  return convertToCSV(rows);
}
```

---

## 7. ã¾ã¨ã‚

### 7.1 ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§å®šç¾©ã—ãŸã“ã¨

```
âœ… å®šç¾©ã—ãŸã“ã¨
â”œâ”€ é€šã„ã¨æ³Šã¾ã‚Šã®çµ±åˆãƒ‡ãƒ¼ã‚¿æ§‹é€ 
â”œâ”€ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆâ—‹ã®è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€ ç½«ç·šã«ã‚ˆã‚‹æ³Šã¾ã‚Šè¡¨ç¾
â”œâ”€ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«
â””â”€ ãƒ‡ãƒ¼ã‚¿æ“ä½œã®æ–¹æ³•
```

---

### 7.2 é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

1. **æ—¥ä»˜ã¯æ–‡å­—åˆ—**ï¼ˆ"YYYY-MM-DD"ï¼‰
2. **æ³Šã¾ã‚ŠæœŸé–“ã¯åˆ©ç”¨è€…ã”ã¨ã«1ã¤**
3. **æ³Šã¾ã‚ŠæœŸé–“å†…ã§kayoiæœªè¨­å®š â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆâ—‹**
4. **æ³Šã¾ã‚Šå‰Šé™¤æ™‚ã¯é€šã„æƒ…å ±ã‚‚å‰Šé™¤**
5. **å‰åŠãƒ»å¾ŒåŠã¯å¼•ãç¶šãä½¿ç”¨å¯èƒ½**ï¼ˆåˆ©ç”¨è€…ãŒæ˜ç¤ºçš„ã«è¨­å®šï¼‰

---

### 7.3 v3.0ã‹ã‚‰ã®ä¸»ãªå¤‰æ›´

| é …ç›® | v3.0 | v4.0 |
|------|------|------|
| ãƒ‡ãƒ¼ã‚¿å˜ä½ | æ—¥åˆ¥ | åˆ©ç”¨è€…åˆ¥ï¼‹æ—¥åˆ¥ |
| section | å¿…é ˆï¼ˆå‰åŠ/å¾ŒåŠ/çµ‚æ—¥ï¼‰ | ä»»æ„ï¼ˆnullå¯ï¼‰ |
| æ³Šã¾ã‚Šæƒ…å ± | ãªã— | tomariPeriodè¿½åŠ  |
| ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤º | ãªã— | æ³Šã¾ã‚ŠæœŸé–“å†…ã§â—‹ |
| ç½«ç·š | ãªã— | é’/è–„é’ã§è¡¨ç¾ |

---

### 7.4 æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ã“ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«åŸºã¥ã„ã¦ã€UIè¨­è¨ˆã¨ãƒ­ã‚¸ãƒƒã‚¯è¨­è¨ˆã‚’è¡Œã„ã¾ã™ï¼š

1. **L2_é€šã„_UIè¨­è¨ˆ.md v4.0** - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼UIã€ç½«ç·šè¡¨ç¤º
2. **L2_é€šã„_ãƒ­ã‚¸ãƒƒã‚¯.md v3.0** - é•·æŠ¼ã—å‡¦ç†ã€æœŸé–“é¸æŠ

---

## ğŸ“š æ¬¡ã«èª­ã‚€ã¹ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­äº†ã—ãŸã‚‰ã€ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«é€²ã‚“ã§ãã ã•ã„ã€‚

### æ¬¡ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

**L2_é€šã„_UIè¨­è¨ˆ.md v4.0**
- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼UIè¨­è¨ˆ
- çŸ­æŠ¼ã—/é•·æŠ¼ã—ã®æ“ä½œ
- ç½«ç·šã«ã‚ˆã‚‹æ³Šã¾ã‚Šè¡¨ç¾

---

## ğŸ“ å‚è€ƒè³‡æ–™

- L1_æŠ€è¡“_å®Ÿè£…åˆ¶ç´„.mdï¼ˆãƒ‡ãƒ¼ã‚¿å‹è¦ç´„ï¼‰
- L0_æ¥­å‹™_å®šå“¡ã®æ³•çš„æ çµ„ã¿.mdï¼ˆé€šã„å®šå“¡15äººã®æ ¹æ‹ ï¼‰
- L2_æ³Šã¾ã‚Š_ãƒ‡ãƒ¼ã‚¿æ§‹é€ .mdï¼ˆæ³Šã¾ã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ã®é•ã„ï¼‰

---

## ğŸ“… æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ | æ‹…å½“ |
|------|----------|---------|------|
| 2025-11-23 | 1.0 | åˆç‰ˆä½œæˆ | Claude |
| 2025-11-23 | 2.0 | startTime/endTimeè¿½åŠ ã€æ™‚åˆ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ  | Claude |
| 2025-11-27 | 3.0 | pickupType/dropoffTypeè¿½åŠ ã€é€è¿ã‚¿ã‚¤ãƒ—ç®¡ç†æ©Ÿèƒ½è¿½åŠ  | Claude |
| 2025-12-19 | 4.0 | æ³Šã¾ã‚ŠæœŸé–“çµ±åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆâ—‹ã€é€šã„è¨˜å·ç°¡ç•¥åŒ– | Claude |

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´12æœˆ19æ—¥  
**æ¬¡å›æ›´æ–°äºˆå®š**: Phase 1å®Ÿè£…ä¸­ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åæ˜ æ™‚

---

## âš ï¸ è¨­è¨ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆv4.0ï¼‰ï¼š

- [x] ã™ã¹ã¦ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å‹ãŒæ˜è¨˜ã•ã‚Œã¦ã„ã‚‹
- [x] Dateå‹ã¨æ–‡å­—åˆ—ã®ä½¿ã„åˆ†ã‘ãŒæ˜ç¢º
- [x] å‹å¤‰æ›ã®è²¬ä»»ãŒæ˜ç¢ºï¼ˆã©ã“ã§å¤‰æ›ã™ã‚‹ã‹ï¼‰
- [x] null/undefinedã®æ‰±ã„ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [x] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«ãŒç¶²ç¾…ã•ã‚Œã¦ã„ã‚‹
- [x] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆâ—‹ã®è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ãŒæ˜ç¢º
- [x] æ³Šã¾ã‚ŠæœŸé–“ã¨é€šã„æƒ…å ±ã®é–¢ä¿‚ãŒæ˜ç¢º

---

**ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­äº†ã—ãŸã‚‰ã€INDEX_ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹æˆ.md ã«æˆ»ã‚Šã€æ¬¡ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«é€²ã‚“ã§ãã ã•ã„ã€‚**