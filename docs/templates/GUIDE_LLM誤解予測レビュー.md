# LLM誤解予測レビューガイド

**作成日**: 2025-11-27  
**用途**: 実装指示書作成時のレビュー（設計書作成後、実装指示書作成前）  
**目的**: LLM実装者が陥りやすい誤解を先回りして防ぐ

---

## 📖 このガイドについて

### 背景

LLM（GitHub Copilot、Claude等）を実装者として使う場合、以下の特性があります：

1. **「効率化」を自然に考える**
   - 共通化できそうなコードはまとめようとする
   - 汎用的な実装を好む
   - 既存パターンを流用しようとする

2. **文字通りの解釈**
   - 「通いセクションの例」を見ると、他のセクションも同様と推測する
   - 暗黙の前提が伝わりにくい
   - 「やらないこと」が明記されていないと、勝手に拡張する

3. **設計思想の理解が浅い**
   - なぜその設計にしたのかが分からない
   - 業務の文脈が見えない
   - 将来の拡張性まで考慮しない

これらの特性により、**論理的には正しいが、設計意図とは逆の実装**をしてしまうことがあります。

---

## 🎯 レビューの目的

実装指示書に以下を追加することで、LLMの誤解を防ぐ：

1. **やらないこと**の明記
2. **設計思想**の説明
3. **誤実装パターン**の警告
4. **理由**の明示

---

## 📋 レビュー手順

### ステップ1: LLMの自然な思考を予測

設計書・実装指示書を読んで、以下を自問してください：

**質問リスト**：
1. 「このコード例を見たLLMは、どう効率化しようと考えるか？」
2. 「共通化できそうな部分はどこか？」
3. 「汎用化できそうな部分はどこか？」
4. 「既存コードから流用できそうな部分はどこか？」
5. 「条件分岐で制御できそうな部分はどこか？」

### 典型的な「効率化の誘惑」

以下のパターンがないか確認してください：

#### パターン1: 共通化の誘惑
```
実装指示: 「通いセクションに3行を表示」
LLMの思考: 「泊まりも訪問も同じような構造だろう
           → 5行の共通HTMLを作って、各セクションで表示制御すれば効率的」
```

#### パターン2: 汎用化の誘惑
```
実装指示: 「通いセクションの例」
LLMの思考: 「これは一例だろう
           → 他のセクションにも適用できるように汎用化しよう」
```

#### パターン3: 流用の誘惑
```
実装指示: 「新しい機能を追加」
LLMの思考: 「既存のプロジェクトAに似た機能がある
           → コピーして使おう」
```

#### パターン4: 簡略化の誘惑
```
実装指示: 「各セクション専用のHTMLを作成」
LLMの思考: 「それぞれ作るのは冗長だ
           → if文で制御する方がシンプル」
```

---

### ステップ2: 設計意図との照合

予測した「効率化」が設計意図と一致するか確認：

**確認項目**：
- [ ] この共通化は設計思想に沿っているか？
- [ ] 将来の拡張性を損なわないか？
- [ ] セクション独立性を保てるか？
- [ ] 保守性は向上するか？
- [ ] 業務の性質の違いを考慮しているか？

**判定基準**：

✅ **設計意図と一致** → 問題なし、そのまま進める

❌ **設計意図と不一致** → 警告を追加（ステップ3へ）

---

### ステップ3: 警告セクションを追加

設計意図と逆方向の「効率化」には、明示的な警告を追加してください。

#### 警告のテンプレート

```markdown
### ⚠️ 【重要】実装前に必読の警告

あなたは今、この実装指示を読んで以下のように考えているかもしれません：

「[予測されるLLMの思考]」

### ❌ これは絶対にやらないでください

**やってはいけない実装パターン**:
1. ❌ [具体的な誤実装パターン1]
2. ❌ [具体的な誤実装パターン2]
3. ❌ [具体的な誤実装パターン3]

### ✅ 正しいアプローチ

[設計意図に沿った実装方法]

### 💡 なぜこうするのか

**設計思想**: [設計思想の名前]

1. [理由1]
   - [詳細説明]
   
2. [理由2]
   - [詳細説明]
   
3. [理由3]
   - [詳細説明]
```

#### 警告の記述例

```markdown
### ⚠️ 【重要】実装前に必読の警告

あなたは今、この実装指示を読んで以下のように考えているかもしれません：

「通いセクションの例を見た。
 きっと泊まりセクションも同じような構造だろう。
 であれば、5行（通い・迎え・送り・泊まり・訪問）の共通HTMLを作って、
 各タブで表示する行をJavaScriptで制御すれば効率的だ。」

### ❌ これは絶対にやらないでください

**やってはいけない実装パターン**:
1. ❌ 5行の共通HTMLを作る
2. ❌ data-section属性で行の表示を制御する
3. ❌ if文で「通いタブなら通い・迎え・送りを表示」のような制御をする
4. ❌ 通いのHTMLを泊まり・訪問セクションにコピーする

### ✅ 正しいアプローチ

**各セクションは完全に独立したHTMLを持ちます**:

- 通いセクション: 通い専用の3行HTML（通い・迎え・送り）
- 泊まりセクション: 泊まり専用の4行HTML（泊まり・重度・中度・軽度）
- 訪問セクション: 訪問専用の1行HTML（訪問のみ）

### 💡 なぜこうするのか

**設計思想: セクション別に特化**

1. **情報過多を防ぐ**
   - 通いタブで「泊まり」の情報を見せる必要がない
   - 各タブは関連情報のみを表示

2. **将来の拡張性**
   - 通いに「1便/2便」を追加しても、泊まり・訪問に影響しない
   - 各セクションが独立しているため、拡張が容易

3. **保守性**
   - 表示制御ロジックが不要
   - if文の複雑なネストがない
   - バグの混入リスクが低い
```

---

### ステップ4: 「やらないこと」を明記

各セクションに以下を追加：

```markdown
### ✅ やること

- [実装すべき内容]

### ❌ やらないこと

- ❌ [実装してはいけない内容1]
- ❌ [実装してはいけない内容2]
- ❌ [実装してはいけない内容3]

### 💡 なぜこうするのか

[設計思想と理由]
```

#### 記述例

```markdown
### ✅ やること

通いセクション（`#kayoi-section`）内に、日別サマリーのHTML構造を追加する。

### ❌ やらないこと

- ❌ 泊まりセクション（`#tomari-section`）には何も追加しない
- ❌ 訪問セクション（`#houmon-section`）には何も追加しない
- ❌ 全体タブ（`#integrated-section`）には何も追加しない
- ❌ 「泊まり」「訪問」の行を含めない

### 💡 なぜこうするのか

Phase 1.5では通いセクションのみを実装します。
泊まり・訪問は業務の性質が異なるため、Phase 2以降で別途設計・実装します。
```

---

### ステップ5: 完成の定義に「制約の遵守」を追加

完成の定義チェックリストに、「やらないこと」の確認項目を追加：

```markdown
## ✅ 完成の定義

### 機能の実装
- [x] [機能1]が動作する
- [x] [機能2]が動作する

### 制約の遵守
- [x] [やらないこと1]が実装されていない
- [x] [やらないこと2]が実装されていない
- [x] [やらないこと3]が実装されていない
```

#### 記述例

```markdown
## ✅ 完成の定義

### 機能の実装
- [x] 日別サマリーが画面に表示される
- [x] 通い・迎え・送りの数字が正しく計算される
- [x] ホバーポップアップが動作する

### 制約の遵守
- [x] 泊まりセクションに日別サマリーが**表示されていない**
- [x] 訪問セクションに日別サマリーが**表示されていない**
- [x] 全体タブに日別サマリーが**表示されていない**
```

---

## 🎓 レビューのコツ

### コツ1: LLMになりきる

「自分がLLMだったら、このコードをどう解釈するか？」を考えてください。

- プログラマーの本能：「共通化したい」
- 効率性の追求：「冗長なコードは避けたい」
- パターン認識：「似たコードは汎用化したい」

### コツ2: 「効率的に見える」誤実装を探す

誤実装は**論理的には正しい**ことが多いです。

例：
- 「5行の共通HTMLで表示制御」← プログラミングとしては正しい
- しかし、設計思想（セクション別に特化）とは逆

### コツ3: 理由を丁寧に説明

「やらないこと」だけ書いても、LLMは納得しません。

必ず**理由**を添えてください：
- なぜその設計にしたのか
- どんな問題を避けるのか
- 将来どう拡張する予定か

### コツ4: 具体的な禁止パターンを列挙

抽象的な警告ではなく、**具体的なコード例**で禁止パターンを示してください。

❌ 悪い例：
```
共通化しないでください。
```

✅ 良い例：
```
❌ やってはいけないこと:
- 5行の共通HTMLを作る
- data-section属性で行の表示を制御する
- if (section === 'kayoi') { ... } のような制御ロジックを書く
```

---

## 📊 効果の測定

このレビューガイドの効果は、以下で測定できます：

### 指標1: 誤実装の減少

**Before**（ガイドなし）:
- 実装者が設計意図と逆の実装をする

**After**（ガイドあり）:
- 警告を読んで思考を修正
- 設計意図に沿った実装をする

### 指標2: 修正作業の削減

**Before**:
- 実装後に「これは違う」と気づく
- 大幅な作り直しが必要

**After**:
- 実装前に警告を読む
- 最初から正しい方向で実装

### 指標3: 設計書の品質向上

このレビューを通じて、設計書自体の曖昧さが明確になります。

---

## 🔄 継続的改善

### 誤実装が発生したら

1. **原因を分析**
   - どの部分が誤解を招いたか？
   - 警告は十分だったか？
   
2. **ガイドを更新**
   - 新しい誤実装パターンを追加
   - 警告の書き方を改善

3. **テンプレートに反映**
   - 将来の実装指示書に反映

### ガイドの更新履歴

| 日付 | 追加された誤実装パターン | 改善内容 |
|------|---------------------|---------|
| 2025-11-27 | 共通化の誘惑 | 初版作成 |
| - | - | - |

---

## 📚 関連ドキュメント

- **CHECKLIST_設計レビュー.md**: 設計書全般のレビュー項目
- **L1_技術_実装制約.md**: 技術的な制約事項
- **INDEX_ドキュメント構成.md**: ドキュメント全体の構成

---

## 🎯 まとめ

### このガイドの価値

LLM実装者は：
- 論理的で効率的なコードを書こうとする
- しかし設計思想を理解していない
- 暗黙の前提が伝わらない

このガイドを使うことで：
- LLMの「自然な思考」を予測できる
- 誤実装を事前に防げる
- 設計意図を確実に伝えられる

### 使うべきタイミング

✅ **実装指示書作成前**
- 設計書を見直す
- LLMの視点でレビュー
- 警告を追加

✅ **設計書レビュー時**
- 曖昧な表現がないか確認
- 誤解を招く記述がないか確認

✅ **誤実装が発生した後**
- 原因を分析
- ガイドを更新
- テンプレートに反映

---

**実装の成功を願っています！** 🎉