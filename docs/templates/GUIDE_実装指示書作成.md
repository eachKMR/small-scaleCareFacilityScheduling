# 実装指示書作成ガイド

**作成日**: 2025年12月5日  
**用途**: 実装指示書を作成する際のガイドライン  
**対象読者**: 設計担当者（Claude）

---

## 📖 このガイドについて

このガイドは、**設計書を実装指示書に変換する際のルールと注意点**をまとめたものです。

### 実装指示書とは

設計書を読んだ実装担当者（GitHub Copilot Agent等）が、
**迷わず実装できる**ように、具体的な手順を記載したドキュメントです。

### 実装指示書と設計書の違い

| 項目 | 設計書 | 実装指示書 |
|------|--------|----------|
| **目的** | 「何を作るか」を定義 | 「どう作るか」を指示 |
| **読者** | 設計担当、実装担当、レビュー担当 | 実装担当のみ |
| **内容** | 概念、構造、ロジック、UI仕様 | 具体的なコード例、修正手順 |
| **スタイル** | 説明的、網羅的 | 命令的、簡潔 |

---

## 🚨 【超重要】長さの制約

### GitHub Copilot Agentのタイムアウト問題

**問題**:
実装指示書が長すぎると、GitHub Copilot Agentに送信した際に以下のエラーが発生します：

```
Request Failed: 408
{"error":{"message":"Timed out reading request body. 
Try again, or use a smaller request size.","code":"user_request_timeout"}}
```

**原因**:
- リクエストボディが大きすぎる
- タイムアウト（読み込み時間超過）

**影響**:
- 実装が開始できない
- 何度試しても同じエラーが出る
- 実装指示書を分割する必要がある

---

### 長さの目安

| 行数 | 判定 | 対応 |
|------|------|------|
| **0-200行** | ✅ 安全 | そのまま送信できる |
| **200-300行** | ⚠️ 注意 | ギリギリ送信できるが、簡潔にする努力を |
| **300-500行** | 🚨 危険 | タイムアウトのリスク大、分割を検討 |
| **500行以上** | ❌ 不可 | ほぼ確実にタイムアウト、必ず分割 |

---

### 分割の目安

**1つの実装指示書 = 1つの独立した作業単位**

#### 分割すべき例

**悪い例**（500行）:
```
Phase 1 実装指示書：通いセクション修正
├─ 修正1: 日別サマリー削除
├─ 修正2: ID名の統一（7箇所）
├─ 修正3: クラス名の統一（2箇所）
├─ 修正4: カレンダーヘッダーの構造修正
├─ 修正5: CSS変数の追加
├─ 修正6: CSS変数の誤参照修正
└─ 修正7: </main>タグの重複削除
```

**良い例**（分割）:
```
修正1_日別サマリー削除.md（100行）
修正2-7_細かい修正.md（200行）
```

または、さらに細かく：
```
修正1_日別サマリー削除.md（100行）
修正2_ID名統一.md（80行）
修正3-7_その他修正.md（120行）
```

---

## ⚠️ ステップ0: 設計書の再確認（最重要）

**実装指示書を書き始める前に、必ずこのチェックリストを実行してください。**

### なぜ必要か？

実装指示書作成者（Claude）が**設計を誤解したまま実装指示書を書く**と：
- 実装担当者（GitHub Copilot）が誤った実装をする
- 修正作業が発生する
- 時間とリソースが無駄になる

**予防策**: 実装指示書を書く前に、設計書を徹底的に確認する

---

### チェックリスト

#### 1. 関連設計書をすべて読む

- [ ] L2層（セクション別）の設計書を読んだか？
  - 例: L2_通い_データ構造.md、L2_通い_UI設計.md、L2_通い_ロジック設計.md
  
- [ ] L3層（統合設計）の設計書を読んだか？
  - 例: L3_UI_統合UI設計.md、U3_UI_日別サマリー.md
  
- [ ] L1層（基礎）の制約を確認したか？
  - 例: L1_技術_実装制約.md、L1_技術_アーキテクチャ設計.md

---

#### 2. 「タブ別の違い」を理解する

**よくある誤解**: 「全タブで同じUIを表示する」

- [ ] 全体タブと通いタブの違いを理解したか？
  - 例: 日別サマリーの表示内容が異なる
  
- [ ] 泊まりタブと訪問タブの違いを理解したか？
  - 例: グリッド構造が異なる
  
- [ ] タブ別の実装範囲を理解したか？
  - 例: Phase 1では通いタブのみ実装

**確認方法**:
```
U3_UI_日別サマリー.md のセクション1.4「タブ別の表示内容」を読む
```

---

#### 3. 「セクション独立性」を理解する

**よくある誤解**: 「共通HTMLで効率化する」

- [ ] 各セクションは完全に独立していることを理解したか？
  - 通いセクションは泊まりセクションを参照しない
  - 泊まりセクションは訪問セクションを参照しない
  
- [ ] 共通化してはいけない部分を理解したか？
  - 例: 日別サマリーのHTML（タブ別に専用HTMLを作成）
  
- [ ] 共通化すべき部分を理解したか？
  - 例: CSS変数、共通コンポーネント（トースト、ダイアログ）

**確認方法**:
```
L1_技術_アーキテクチャ設計.md のセクション2.4「データの独立性マトリックス」を読む
GUIDE_LLM誤解予測レビュー.md の警告例を読む
```

---

#### 4. 引継ぎドキュメントに頼りすぎない

**よくある誤解**: 「引継ぎドキュメントに書いてあることが正しい」

- [ ] 引継ぎドキュメントは**要約**であることを理解したか？
  - 詳細は設計書で確認する必要がある
  
- [ ] 引継ぎドキュメントに矛盾がないか確認したか？
  - 例: 「日別サマリーが5行（設計は3行）」→ 実際はタブ別に異なる
  
- [ ] 設計書と引継ぎドキュメントで異なる場合、設計書を優先したか？

---

#### 5. 曖昧な部分を明確にする

**よくある誤解**: 「〜のような」「〜など」は具体例が無限にある

- [ ] 「〜のような」という表現がある場合、具体例を確認したか？
  - 例: 「通いセクションのような構造」→ 他のセクションも同じ？
  
- [ ] 「〜など」という表現がある場合、全パターンを確認したか？
  - 例: 「通い・泊まり・訪問など」→ 他にもある？
  
- [ ] 設計書に書かれていないことは**やらない**ことを理解したか？

---

### よくある誤解パターン

#### パターン1: 「例」を「すべて」だと思う

**誤解**: 「通いセクションの例を見た。他のセクションも同じだろう」

**正しい理解**: 「例」は**あくまで例**。他のセクションは別途設計書を確認する。

**確認方法**: 
- L2_泊まり_UI設計.md を読む
- L2_訪問_UI設計.md を読む
- 構造が異なることを確認する

---

#### パターン2: 「共通」の範囲を勘違い

**誤解**: 「日別サマリーは共通 → 全タブで同じ内容を表示」

**正しい理解**: 「日別サマリーという**機能**は共通だが、表示内容はタブ別」

**確認方法**:
- U3_UI_日別サマリー.md のセクション1.4を読む
- タブ別の表示内容の表を確認する

---

#### パターン3: 「効率化」を優先しすぎる

**誤解**: 「共通HTMLで制御した方が効率的だから、そうしよう」

**正しい理解**: 設計思想（セクション独立性）が最優先。効率化は二の次。

**確認方法**:
- GUIDE_LLM誤解予測レビュー.md を読む
- 「やってはいけない実装パターン」を確認する

---

### チェック完了の確認

すべてのチェックボックスに✓が入ったら、次のステップ（実装指示書の作成）に進んでください。

**1つでも未確認の項目がある場合は、実装指示書を書き始めないでください。**

---

## 📋 実装指示書の構成

### 基本テンプレート

```markdown
# [タイトル]

**作成日**: YYYY-MM-DD  
**優先度**: 高/中/低  
**所要時間**: XX分

---

## 🎯 やること

[一文で要約]

---

## ⚠️ 重要な警告（必要に応じて）

### ❌ やってはいけないこと
### ✅ やること
### 💡 理由

---

## 📋 修正内容

### ステップ1: [作業名]
[具体的なコード例]

### ステップ2: [作業名]
[具体的なコード例]

---

## ✅ 完成の確認

- [ ] [確認項目1]
- [ ] [確認項目2]

---

以上です。
```

---

### セクションの説明

#### 1. ヘッダー情報

```markdown
# [タイトル]

**作成日**: YYYY-MM-DD  
**優先度**: 高/中/低  
**所要時間**: XX分
```

- タイトル：何をする指示書か一目で分かる
- 優先度：緊急性を明示
- 所要時間：実装の目安

---

#### 2. やること（要約）

```markdown
## 🎯 やること

[一文で要約]
```

- 一文で要約
- 読者がすぐに理解できる

**例**:
```
通いセクション（`#kayoi-section`）内の日別サマリーを完全に削除する
```

---

#### 3. 警告セクション（必要に応じて）

```markdown
## ⚠️ 重要な警告

### ❌ やってはいけないこと
### ✅ やること
### 💡 理由
```

- LLM誤解予測レビューで特定した誤実装パターンを記載
- 詳細は `GUIDE_LLM誤解予測レビュー.md` を参照

**いつ必要か**:
- 実装者が「効率化」を考えそうな場合
- 設計意図と逆の実装をしやすい場合
- 暗黙の前提がある場合

**例**:
```markdown
### ❌ やってはいけないこと

- コメントアウトして残す
- `display: none` で非表示にする
- Phase 2のために残す

### ✅ やること

- **完全に削除する**（HTML、CSS、JavaScript）

### 💡 理由

- 全体サマリーと重複して分かりにくい
- ウィンドウスペースを圧迫
- Phase 1は「シンプルに動くもの」を優先
```

---

#### 4. 修正内容

```markdown
## 📋 修正内容

### ステップ1: [作業名]
[具体的なコード例]

### ステップ2: [作業名]
[具体的なコード例]
```

- ステップバイステップで記載
- 具体的なコード例を必ず含める
- 「どこを」「どう直すか」を明確に

**良い例**:
```markdown
### ステップ1: HTMLを削除

**ファイル**: `index.html`

**削除対象**:

```html
<!-- この部分を完全に削除 -->
<div class="daily-summary kayoi-summary">
  ...
</div>
```

**修正後**:

```html
<section id="kayoi-section" class="section kayoi-section">
  <!-- 日別サマリーは削除済み -->
  
  <!-- 通い予定グリッド -->
  <div class="kayoi-grid">
    ...
  </div>
</section>
```
```

**悪い例**:
```markdown
### ステップ1: HTMLを修正

日別サマリーを削除してください。
```

---

#### 5. 完成の確認

```markdown
## ✅ 完成の確認

- [ ] [確認項目1]
- [ ] [確認項目2]
```

- チェックボックス形式
- 機能の動作確認
- 制約の遵守確認

**例**:
```markdown
- [ ] `#kayoi-section` 内に `.kayoi-summary` が**存在しない**
- [ ] コメントアウトで残っていない
- [ ] 通い予定グリッドは正常に表示される
- [ ] エラーがコンソールに出ていない
```

---

## 🎓 作成のコツ

### コツ1: 簡潔に書く

- 説明は最小限
- コード例を中心に
- 「なぜそうするか」は設計書に任せる

**悪い例**（冗長）:
```
日別サマリーは、元々Phase 1.5で通いセクション専用として設計されていましたが、
Phase 2の設計で全体サマリーに統合されることになりました。
そのため、通いセクション内の日別サマリーは不要になったので削除します。
```

**良い例**（簡潔）:
```
通いセクション内の日別サマリーを削除する（全体サマリーに統合されたため）。
```

---

### コツ2: コード例は「修正前/修正後」で示す

**良い例**:
```markdown
**修正前**:
```html
<button id="prev-month-btn">
```

**修正後**:
```html
<button id="prev-month">
```
```

**悪い例**:
```markdown
`prev-month-btn` を `prev-month` に変更してください。
```

---

### コツ3: ファイル名を明記

**良い例**:
```
**ファイル**: `css/kayoi.css`
```

**悪い例**:
```
CSSファイルを修正してください。
```

---

### コツ4: 検索しやすいキーワードを使う

- クラス名、ID名は必ず `` ` `` で囲む
- ファイル名も `` ` `` で囲む

**例**:
```
`#kayoi-section` 内の `.kayoi-summary` を削除
```

こうすることで、実装者がコード内で検索しやすくなります。

---

## 🔄 LLM誤解予測レビューとの関係

### レビューの流れ

```
1. 設計書を作成
   ↓
2. LLM誤解予測レビューを実施
   ├─ LLMの「効率化の誘惑」を予測
   ├─ 誤実装パターンを特定
   └─ 警告が必要か判断
   ↓
3. 実装指示書を作成
   ├─ 警告セクションを追加（必要に応じて）
   ├─ 「やらないこと」を明記
   └─ 長さをチェック（200行以内推奨）
   ↓
4. 実装指示書を分割（必要に応じて）
   ↓
5. 実装担当者に渡す
```

---

### 警告セクションの判断基準

**警告が必要なケース**:
- [ ] 実装者が「共通化」「汎用化」したくなりそう
- [ ] 設計意図と逆の実装をしやすい
- [ ] 既存コードの流用を考えそう
- [ ] 「効率的に見える」誤実装がある

**警告が不要なケース**:
- [ ] 機械的な修正（ID名の変更等）
- [ ] 明確な指示で誤解の余地がない
- [ ] 単純な追加・削除

---

## 📊 分割の判断フローチャート

```
実装指示書を作成
  ↓
行数をカウント
  ↓
200行以内？
  ├─ YES → そのまま完成
  └─ NO → 分割を検討
          ↓
        独立した作業単位に分けられる？
          ├─ YES → 作業単位ごとに分割
          │         （例：修正1、修正2-7）
          └─ NO → 優先度で分割
                    （例：最重要、高優先、低優先）
```

---

## 📚 実装指示書の例

### 良い例（簡潔、具体的）

```markdown
# 修正1: 通いセクション内の日別サマリーを削除

**作成日**: 2025年12月5日  
**優先度**: 最重要  
**所要時間**: 10分

---

## 🎯 やること

通いセクション（`#kayoi-section`）内の日別サマリーを完全に削除する

---

## ⚠️ 重要な警告

### ❌ やってはいけないこと
- コメントアウトして残す
- `display: none` で非表示にする

### ✅ やること
- **完全に削除する**（HTML、CSS、JavaScript）

### 💡 理由
- 全体サマリーと重複して分かりにくい
- ウィンドウスペースを圧迫

---

## 📋 修正内容

### ステップ1: HTMLを削除

**ファイル**: `index.html`

**削除対象**:
```html
<div class="daily-summary kayoi-summary">
  ...
</div>
```

---

## ✅ 完成の確認

- [ ] `.kayoi-summary` が存在しない
- [ ] コメントアウトで残っていない
- [ ] エラーが出ていない

---

以上です。
```

---

### 悪い例（冗長、曖昧）

```markdown
# Phase 1 実装指示書

このドキュメントは、Phase 1の実装を行うための指示書です。
以下の修正を実施してください。

## 背景

前回のレビューで、実装と設計書にズレがあることが分かりました。
設計書v3.0では、日別サマリーは全体サマリーとして配置されることになっており...
（長々と説明が続く）

## 修正内容

日別サマリーを修正してください。
その際、通いセクション内の日別サマリーは削除する必要があります。
また、CSSも修正が必要です。
（具体的なコード例なし）
```

**問題点**:
- 背景説明が長すぎる
- 「どこを」「どう直すか」が曖昧
- コード例がない
- 完成の定義がない

---

## 🎯 チェックリスト

実装指示書を作成したら、以下をチェックしてください：

### 内容の確認

- [ ] タイトルで何をするか分かる
- [ ] 「やること」が一文で要約されている
- [ ] ファイル名が明記されている
- [ ] 具体的なコード例がある
- [ ] 「修正前/修正後」が示されている
- [ ] 完成の確認項目がある

### 長さの確認

- [ ] 200行以内である
- [ ] 200行を超える場合、分割を検討した

### LLM誤解予測レビュー

- [ ] LLM誤解予測レビューを実施した
- [ ] 警告セクションが必要か判断した
- [ ] 「やらないこと」を明記した（必要に応じて）

### 品質の確認

- [ ] 簡潔に書かれている
- [ ] 検索しやすいキーワードを使っている
- [ ] 実装者が迷わない内容になっている

---

## 📝 テンプレート

実装指示書を作成する際は、以下のテンプレートを使用してください：

```markdown
# [タイトル]

**作成日**: YYYY-MM-DD  
**優先度**: 高/中/低  
**所要時間**: XX分

---

## 🎯 やること

[一文で要約]

---

## ⚠️ 重要な警告（必要に応じて）

### ❌ やってはいけないこと
- [誤実装パターン1]
- [誤実装パターン2]

### ✅ やること
- [正しいアプローチ]

### 💡 理由
- [設計思想と理由]

---

## 📋 修正内容

### ステップ1: [作業名]

**ファイル**: `[ファイル名]`

**削除対象** / **追加内容** / **修正内容**:
```[言語]
[コード例]
```

**修正後**:
```[言語]
[コード例]
```

### ステップ2: [作業名]

...

---

## ✅ 完成の確認

- [ ] [確認項目1]
- [ ] [確認項目2]
- [ ] [確認項目3]

---

以上です。
```

---

## 📚 関連ドキュメント

- **GUIDE_LLM誤解予測レビュー.md** - 警告セクション作成のガイド
- **CHECKLIST_設計レビュー.md** - 設計書全般のレビュー
- **INDEX_ドキュメント構成.md** - ドキュメント全体の構成

---

## 🎓 まとめ

### 実装指示書の成功の鍵

1. **簡潔さ**
   - 説明は最小限
   - コード例中心

2. **具体性**
   - ファイル名を明記
   - 修正前/修正後を示す

3. **適切な長さ**
   - 200行以内推奨
   - 長すぎたら分割

4. **警告の明示**
   - LLM誤解予測レビューを実施
   - 誤実装パターンを防ぐ

5. **完成の定義**
   - チェックボックス形式
   - 確認項目を明確に

---

**良い実装指示書は、実装の成功率を大幅に上げます！** 🎉

---

## 📅 更新履歴

| 日付 | バージョン | 変更内容 | 担当 |
|------|----------|---------|------|
| 2025-12-05 | 1.0 | 初版作成 | Claude |

---

**最終更新**: 2025年12月5日