# プロジェクトB: 小規模多機能利用調整システム

**バージョン**: 1.2.0 (Phase 1)  
**作成日**: 2025年11月29日  
**更新日**: 2025年12月31日

---

## ⚠️ 重要：このREADMEを読む前に

**あなたはGitHub Copilot（実装担当）ですか？それとも人間の開発者ですか？**

### GitHub Copilotの場合
👉 **必ず `docs/INDEX_ドキュメント構成.md` の「実装担当（GitHub Copilot）の方へ」セクションから読み始めてください**

このREADMEだけでは**実装に必要な情報が不足**しています。特に以下が理解できません：
- セクション独立性の原則（最重要）
- 実装指示書の読み方
- 「効率化の誘惑」を避ける方法

### 人間の開発者の場合
このREADMEで概要を把握した後、`docs/INDEX_ドキュメント構成.md` で詳細を確認してください。

---

## 📖 概要

小規模多機能型居宅介護の**月別利用予定表**を管理し、**利用予定調整・新規利用者獲得に向けたリソース配分や空き状況の示唆**といった業務上の思考を支援するシステムです。

### プロジェクトの本質

```
小規模多機能の利用調整
  ＝
複雑な制約の中で最適解を探す「制約パズル」
  ↓
プロジェクトBは
「パズルとしての快感」を引き出す設計
  ↓
調整業務が
「ストレスの塊」から「気持ちよく最適解を探す作業」に変わる
```

**詳細**: `docs/L1_概要_プロジェクト概要.md` の「3.1 基本コンセプト：調整業務は制約パズル」

---

## 🎯 プロジェクトの目的

### 1. 属人性の軽減
ベテランの「暗黙知」を可視化し、新人でも調整できるようにする

### 2. 空き状況の即座の把握
「今週末、泊まれますか？」に即答できるようにする

### 3. 稼働率の向上（Phase 3以降）
空き状況を俯瞰し、営業活動を支援する

### 4. 調整業務の「快感」化
制約パズルとしての快感を引き出し、業務を楽しくする

**詳細**: `docs/L1_概要_プロジェクト概要.md` の「1.3 プロジェクトの目的」

---

## 🔧 主な機能

### Phase 1（現在の実装対象）

#### ✅ 通いサービス管理
- 前半・後半の定員管理（各15人）
- 日別予定表（グリッド表示）
- 定員チェック（リアルタイム警告）
- 記号管理（○◓◒）
- 送迎タイプ管理
- **長押しで泊まり期間設定**（カレンダー表示）
- **罫線による泊まり表現**（青/薄青）

#### ✅ 泊まりサービス管理
- **未割当行**（通いUIで設定された泊まり期間を縦積み表示）
- 居室軸での予約管理（9室）
- 期間管理（入室日→滞在→退室日）
- **ドラッグ&ドロップで部屋割り当て**
- 居室重複チェック
- 夜勤負担度の可視化

#### ✅ 訪問サービス管理
- 時間帯別スケジュール管理
- 回数カウント
- 時間帯の可視化

#### ✅ CSV入出力
- CAREKARTEの「算定基礎CSV」からのインポート
- 予定データのエクスポート

**重要**: Phase 1では以下は**対象外**です
- ❌ 最適化スコア表示（Phase 3）
- ❌ AI提案機能（Phase 3）
- ❌ サーバー連携（Phase 2）

**詳細**: `docs/L1_概要_プロジェクト概要.md` の「2. プロジェクトのスコープ」

---

## 🏗️ アーキテクチャの核心原則

### 原則1: セクション独立性（最重要）

**データクラスは独立、UIクラスは自由にデータを扱える**

```
【データクラスの独立】
通いデータ（UserScheduleData）
  ↓ 参照しない
泊まりデータ（TomariReservation）
  ↓ 参照しない
訪問データ（HoumonSchedule）

【UIクラスの自由】
通いUI（KayoiUI）
  ├─ UserScheduleData を扱う
  ├─ TomariReservation も扱う（罫線表示のため）← OK
  └─ #kayoi-section のDOMのみ操作

泊まりUI（TomariUI）
  ├─ TomariReservation を扱う
  └─ #tomari-section のDOMのみ操作

訪問UI（HoumonUI）
  ├─ HoumonSchedule を扱う
  └─ #houmon-section のDOMのみ操作
```

**本質的な制約（3つのみ）**:
1. **データクラス同士は独立** - UserScheduleDataはTomariReservationを参照しない
2. **UI間のDOM操作禁止** - 通いUIは泊まりUIのDOMを触らない
3. **書き込み責任の明確化** - どのUIがどのデータを作成・更新するか明確にする

**理由**: 並行開発、保守性、テスト容易性、段階的リリース

**詳細**: `docs/L1_技術_実装制約.md` のセクション2.2、`docs/L1_概要_プロジェクト概要.md` の「4. セクション独立性の原則」

---

### 原則2: 日付軸思考

「この日は誰が利用するか」を中心に設計

```
月別予定表
  ├─ 横軸：日付（1日〜31日）
  ├─ 縦軸：利用者
  └─ セル：利用予定（○◓◒）
```

---

### 原則3: 居室管理重視

泊まりセクションは**居室を主軸**とした設計

```
居室軸グリッド
  ├─ 横軸：日付
  ├─ 縦軸：未割当行 + 居室（1号室〜9号室）
  └─ セル：苗字表示（記号なし）
```

**詳細**: `docs/L0_業務_居室管理の重要性.md`

---

### 原則4: CAREKARTEとの補完関係

```
プロジェクトB：予定調整に特化
  ├─ 月別予定表の管理
  ├─ 定員チェック
  ├─ 空き状況の可視化
  └─ 調整支援

CAREKARTE：記録・請求に特化
  ├─ 日々の実施記録
  ├─ 利用票・提供票
  ├─ 請求データ生成
  └─ 国保連への請求
```

**データ連携**: 
- CAREKARTE → プロジェクトB: 算定基礎CSV
- プロジェクトB → CAREKARTE: 画面表示（手動転記）

**詳細**: `docs/L0_業務_介護ソフトとの関係.md`

---

## 📁 プロジェクト構成

```
project-b/
├── README.md                    # このファイル
├── .gitignore
├── docs/                        # 設計ドキュメント（35文書）
│   ├── INDEX_ドキュメント構成.md    # 📍 必読：最初に読むドキュメント
│   ├── L0_業務_*.md              # 業務知識（6文書）
│   ├── L1_*.md                   # 基礎設計（7文書）
│   ├── L2_*.md                   # セクション別設計（9文書）
│   ├── L3_*.md                   # 統合設計（5文書）
│   └── GUIDE_*.md                # ガイドドキュメント（4文書）
│   └── TEMPLATE_*.md             # テンプレート（2文書）
│   └── CHECKLIST_*.md            # チェックリスト（1文書）
├── src/                         # ソースコード
│   ├── index.html
│   ├── css/
│   ├── js/
│   │   ├── main.js              # エントリーポイント
│   │   ├── common/              # 共通モジュール
│   │   ├── kayoi/               # 通いセクション
│   │   ├── tomari/              # 泊まりセクション
│   │   └── houmon/              # 訪問セクション
│   └── assets/
└── tests/                       # テスト
    └── manual/                  # 手動テストチェックリスト
```

---

## 🚀 セットアップ

### 前提条件
- VS Code
- Live Server拡張機能
- モダンブラウザ（Chrome, Edge, Firefox, Safari）

### 手順

```bash
# 1. リポジトリのクローン
git clone [repository-url]
cd project-b

# 2. VS Codeで開く
code .

# 3. Live Serverで起動
# VS Codeで src/index.html を開く
# 右クリック → "Open with Live Server"
# ブラウザで http://localhost:5500/src/ が開く
```

---

## 📚 ドキュメント

### ドキュメントの階層構造

```
第0層（業務知識）← まずここを読む
  ├─ 小規模多機能とは
  ├─ 定員の法的枠組み
  ├─ 居室管理の重要性
  ├─ 調整業務の制約
  ├─ 新規利用者獲得
  └─ 介護ソフトとの関係

第1層（基礎）
  ├─ プロジェクト概要
  ├─ 共通データ構造
  ├─ 技術仕様
  ├─ アーキテクチャ設計
  ├─ 実装制約
  ├─ 制約ゲーム全体設計
  └─ 実装の方針

第2層（セクション別）
  ├─ 通い（データ/UI/ロジック）
  ├─ 泊まり（データ/UI/ロジック）
  └─ 訪問（データ/UI/ロジック）

第3層（統合）
  ├─ 統合UI設計
  ├─ 日別サマリー設計
  ├─ CSV仕様
  ├─ Excel仕様
  └─ 調整支援機能
```

### 📍 最初に読むべきドキュメント

1. **`docs/INDEX_ドキュメント構成.md`**
   - プロジェクト全体のナビゲーション
   - 役割別の読書ガイド（設計担当 / 実装担当）
   - 状況別の読み方（新規参加 / 引継ぎ / 特定セクション）

2. **第0層（業務知識）全6文書**
   - プロジェクトの「なぜ」を理解する
   - 設計判断の根拠を理解する

**重要**: INDEXから読み始めないと、このプロジェクトの本質を理解できません

---

## 🛠️ 技術スタック

### Phase 1（現在）

| 技術 | 用途 |
|------|------|
| HTML5 | マークアップ |
| CSS3 | スタイリング |
| JavaScript (ES2022+) | ロジック |
| Vanilla JS | フレームワーク不使用 |
| localStorage | データ永続化 |
| ES Modules | モジュール管理 |

**フレームワークを使わない理由**:
- シンプルさを優先
- 学習コストを下げる
- GitHub Copilotとの相性が良い

### Phase 2以降（予定）

- サーバー連携（REST API）
- データベース（PostgreSQL等）
- ビルドツール（Vite等）
- テストフレームワーク（Vitest等）

---

## 🎨 設計原則

### 設計品質の5原則（前プロジェクトの教訓）

1. **曖昧さは実装時ではなく、設計時に排除する**
2. **データ型を明示する**（文字列かDateか？）
3. **インタラクションを詳細に記述する**（クリックしたらどうなる？）
4. **状態遷移を図示する**（どの状態からどの状態に遷移する？）
5. **テスト仕様書を先に書く**（何をテストすれば完成？）

### 実装品質の原則（このプロジェクトで確立）

6. **LLM誤解予測レビューを実施する**（実装指示書作成前）
   - LLM実装者の「効率化の誘惑」を予測
   - 誤実装パターンを先回りして警告
   - 「やること」「やらないこと」「なぜか」を明記

### 引継ぎの原則（このプロジェクトで確立）

7. **チャット切り替え時は引継ぎドキュメントを作成する**
   - 必ず読むべきドキュメント（読む順序）を明記
   - 読む理由を説明
   - 読まなくていいドキュメントも明示

**詳細**: `docs/CHECKLIST_設計レビュー.md`, `docs/GUIDE_LLM誤解予測レビュー.md`

---

## ⚠️ GitHub Copilot（実装担当）への重要な注意

### 注意1: 「効率化の誘惑」に注意

あなたは優秀なプログラマーなので、こう考えるかもしれません：

```
「通いセクションの実装を見た。
 きっと泊まりも訪問も同じような構造だろう。
 であれば、共通のHTMLを作って、
 各タブで表示を制御すれば効率的だ。」
```

### ❌ これは絶対にやらないでください

**理由**:
- 各セクションは**意図的に独立**させている
- 業務の性質が異なるため、分離が必要
- 共通化すると将来の拡張が困難になる

**正しいアプローチ**:
- 実装指示書の範囲だけを実装する
- 他のセクションのことは考えない
- 共通化は設計担当が判断する

### 注意2: 実装前に必ずドキュメントを読む

```
実装指示書を受け取ったら：
1. docs/INDEX_ドキュメント構成.md の「実装担当の方へ」を読む
2. 該当するL2層の設計書を読む
3. GUIDE_LLM誤解予測レビュー.md を読む
4. 実装指示書の⚠️警告セクションを確認
5. 実装開始
```

**詳細**: `docs/INDEX_ドキュメント構成.md` の「実装担当（GitHub Copilot）の方へ」

---

## 🧪 テスト

### Phase 1（手動テスト）

```bash
# tests/manual/ にチェックリストあり
tests/manual/kayoi_test.md    # 通いセクションのテスト
tests/manual/tomari_test.md   # 泊まりセクションのテスト
tests/manual/houmon_test.md   # 訪問セクションのテスト
```

### Phase 2以降（自動テスト）

```bash
npm test
```

---

## 📦 データ構造

### マスタデータ

| データ | 最大数 | 説明 |
|--------|--------|------|
| 利用者（User） | 29人 | 登録定員 |
| 職員（Staff） | - | 訪問サービス担当者 |
| 居室（Room） | 9室 | 泊まりサービス |

### 予定データ

| データ | 説明 |
|--------|------|
| 通い予定（UserScheduleData） | 前半・後半の利用、**泊まり期間** |
| 泊まり予約（TomariReservation） | 居室・期間管理、**未割当（roomId: null）対応** |
| 訪問予定（HoumonSchedule） | 時間帯・回数管理 |

**重要な設計変更（v1.2.0）**:
- `UserScheduleData`に`tomariPeriod`を追加（通いUIでの罫線表示用）
- `TomariReservation.roomId`をnull許可（未割当機能）

**詳細**: `docs/L1_データ_共通データ構造.md`, `docs/L2_泊まり_データ構造.md v2.0`

---

## 🔧 開発ガイド

### ディレクトリ構造の原則

```javascript
// ✅ 推奨：UIクラスは複数のデータクラスを扱える
class KayoiUI {
  constructor(kayoiData, tomariData) {
    this.kayoiData = kayoiData;    // 通いデータ
    this.tomariData = tomariData;  // 泊まりデータも使う（罫線表示のため）
  }
  
  renderCell(userId, date) {
    const symbol = this.kayoiData.getSymbol(userId, date);
    const border = this.tomariData.getBorderState(userId, date);
    return `<div class="${border}">${symbol}</div>`;
  }
}

// ✅ 推奨：イベント駆動でUI間通信
document.dispatchEvent(new CustomEvent('kayoi:scheduleAdded', {
  detail: { userId, date, section }
}));

// ❌ 避ける：データクラス間の参照
class UserScheduleData {
  constructor() {
    this.tomariReservation = null;  // ❌ TomariReservationへの参照
  }
}

// ❌ 避ける：UI間のDOM操作
class KayoiUI {
  render() {
    // 泊まりUIのDOMを直接操作（これはNG）
    document.querySelector('#tomari-section .cell').textContent = '...';
  }
}
```

### 命名規則

- **クラス**: PascalCase（例: `KayoiSchedule`）
- **ファイル**: PascalCase（例: `KayoiSchedule.js`）
- **関数**: camelCase（例: `checkCapacity`）
- **定数**: UPPER_SNAKE_CASE（例: `MAX_CAPACITY`）

---

## 📅 ロードマップ

### Phase 1（現在）- ブラウザ完結型

- [x] ドキュメント作成（35文書）
- [x] 泊まりUI設計変更（未割当行、D&D）
- [ ] 共通基盤実装
- [ ] 通いセクション実装
- [ ] 泊まりセクション実装
- [ ] 訪問セクション実装
- [ ] CSV入出力

### Phase 2 - サーバー連携

- [ ] REST API実装
- [ ] データベース連携
- [ ] ユーザー認証
- [ ] 複数端末同期

### Phase 3 - 調整支援機能

- [ ] 空き状況分析
- [ ] 最適化スコア表示
- [ ] AI提案機能（検討）
- [ ] 成長の可視化

---

## 🎯 成功の定義

### Phase 1の成功基準

**定量的基準**:
- ✓ 1事業所で実運用開始
- ✓ 調整担当者が週5日使用
- ✓ 3セクションすべての予定の80%以上がシステムに入力
- ✓ 定員チェックの自動化率100%

**定性的基準**:
- ✓ 調整担当者が「紙より使いやすい」と評価
- ✓ 新人が「分かりやすい」と評価
- ✓ バグ・不具合が週1回未満

---

## 🐛 既知の問題

現在なし（Phase 1実装開始）

---

## 🤝 貢献

このプロジェクトは現在開発中です。

---

## 📝 ライセンス

（未定）

---

## 📞 お問い合わせ

（未定）

---

## 🔗 関連リンク

- [プロジェクト概要](docs/L1_概要_プロジェクト概要.md)
- [ドキュメント構成](docs/INDEX_ドキュメント構成.md)
- [設計レビューチェックリスト](docs/CHECKLIST_設計レビュー.md)

---

## 📝 更新履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2025-11-29 | 1.0.0 | 初版作成 |
| 2025-11-29 | 1.1.0 | ドキュメント構成更新（27→35文書） |
| 2025-12-31 | 1.2.0 | セクション独立性の説明を正確化、泊まりUI設計変更を反映 |

---

**最終更新**: 2025年12月31日  
**バージョン**: 1.2.0 (Phase 1)

---

## 📌 再掲：このREADMEを読み終えたら

### GitHub Copilotの場合
👉 **`docs/INDEX_ドキュメント構成.md` の「実装担当（GitHub Copilot）の方へ」を必ず読んでください**

### 人間の開発者の場合
👉 **`docs/INDEX_ドキュメント構成.md` で詳細ドキュメントを確認してください**

**特に重要**: 第0層（業務知識）を読まずに実装すると、業務の本質を見失います。