<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="小規模多機能型居宅介護の利用予定調整システム">
  <title>小規模多機能予定調整B</title>
  
  <!-- CSS -->
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/integration.css">
  <link rel="stylesheet" href="css/kayoi.css">
  <link rel="stylesheet" href="css/tomari.css">
  <link rel="stylesheet" href="css/houmon.css">
  <link rel="stylesheet" href="css/daily-summary.css">
</head>
<body>
  <div id="app">
    <!-- 統合ヘッダー（カレンダー操作含む） -->
    <header class="app-header">
      <div class="header-left">
        <h1 class="app-title">小規模多機能予定調整B</h1>
        <div class="calendar-controls">
          <button id="prev-month" class="nav-button">◀</button>
          <h2 id="current-month">2025年11月</h2>
          <button id="next-month" class="nav-button">▶</button>
          <button id="today-button" class="nav-button">今月</button>
        </div>
      </div>
      <div class="header-right">
        <button id="print-button" class="header-button">🖨️ 印刷</button>
        <button id="export-button" class="header-button">💾 CSV</button>
        <button id="settings-button" class="header-button">⚙️</button>
        <button id="csv-import-btn" class="header-button">📥</button>
        <button id="help-button" class="header-button">❓</button>
      </div>
    </header>

    <!-- タブナビゲーション（コンパクト） -->
    <nav class="section-tabs compact">
      <button class="tab-button active" data-target="summary">全体</button>
      <button class="tab-button" data-target="kayoi-section">通い</button>
      <button class="tab-button" data-target="tomari-section">泊まり</button>
      <button class="tab-button" data-target="houmon-section">訪問</button>
    </nav>

    <!-- メインコンテンツ -->
    <main class="main-content">
      <!-- 日別サマリー -->
      <section id="summary" class="daily-summary">
        <table class="summary-table">
          <tbody id="summary-tbody">
            <!-- 日別サマリーの内容がJavaScriptで生成される -->
          </tbody>
        </table>
      </section>

      <!-- カレンダー見出し（sticky固定） -->
      <div class="calendar-header-ruler">
        <table class="calendar-ruler-table">
          <tbody>
            <!-- 日付行 -->
            <tr class="date-row" id="calendar-date-row">
              <td class="label-cell"></td>
              <!-- 日付セルがJavaScriptで生成される -->
            </tr>
            <!-- 曜日行 -->
            <tr class="weekday-row" id="calendar-weekday-row">
              <td class="label-cell"></td>
              <!-- 曜日セルがJavaScriptで生成される -->
            </tr>
          </tbody>
        </table>
      </div>

      <!-- 通いセクション -->
      <section id="kayoi-section" class="section kayoi-section">
        <!-- ❌ v3.1: 定員表示は削除済み（日別サマリーで管理） -->
        
        <div class="section-content">
          <div id="kayoi-grid">
            <!-- 通いのグリッドがここに描画される -->
          </div>
        </div>
      </section>

      <!-- 泊まりセクション -->
      <section id="tomari-section" class="section tomari-section">
        <h3 class="section-title">泊まり（ショートステイ）<span class="capacity-label">定員: 9人/日</span></h3>
        <div class="section-content">
          <div class="tomari-grid-container">
            <table id="tomari-grid" class="schedule-grid">
              <tbody id="tomari-tbody">
                <!-- 居室行はJavaScriptで生成 -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- 訪問セクション -->
      <section id="houmon-section" class="section houmon-section">
        <h3 class="section-title">訪問（訪問介護）</h3>
        <div class="section-content">
          <div class="houmon-grid-container">
            <table id="houmon-grid" class="schedule-grid">
              <tbody id="houmon-tbody">
                <!-- 利用者行はJavaScriptで生成 -->
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </main>

    <!-- フッター -->
    <footer class="app-footer">
      <div class="footer-left">
        <span id="last-saved">最終保存: --</span>
      </div>
      <div class="footer-right">
        <span>Version 1.0 (Phase 1)</span>
      </div>
    </footer>
  </div>

  <!-- モーダル・トースト等の共通コンポーネント -->
  <div id="modal-overlay"></div>
  <div id="modal"></div>
  <div id="toast-container"></div>
  <div id="loading" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 10000;">
    読み込み中...
  </div>

  <!-- カレンダーダイアログ -->
  <div id="tomari-calendar" class="calendar-dialog" style="display: none;">
    <div class="calendar-header">
      <button class="month-nav prev">◀</button>
      <span class="month-title">2025年 11月</span>
      <button class="month-nav next">▶</button>
    </div>
    
    <div class="calendar-body">
      <table class="calendar-table">
        <thead>
          <tr>
            <th>日</th>
            <th>月</th>
            <th>火</th>
            <th>水</th>
            <th>木</th>
            <th>金</th>
            <th>土</th>
          </tr>
        </thead>
        <tbody id="calendar-tbody">
          <!-- 動的に生成 -->
        </tbody>
      </table>
    </div>
    
    <div class="calendar-footer">
      <button id="calendar-clear-btn">クリア</button>
      <button id="calendar-confirm-btn">戻る</button>
    </div>
  </div>

  <!-- JavaScript (ES Modules) -->
  <script type="module" src="js/main.js"></script>
</body>
</html>
