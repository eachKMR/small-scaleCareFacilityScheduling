<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TomariUI ãƒ†ã‚¹ãƒˆ</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .test-container {
      background: white;
      border-radius: 8px;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #333;
      border-bottom: 3px solid #4CAF50;
      padding-bottom: 10px;
    }
    
    h2 {
      color: #666;
      margin-top: 30px;
      border-left: 4px solid #4CAF50;
      padding-left: 10px;
    }
    
    .test-section {
      margin: 20px 0;
      padding: 15px;
      background: #fafafa;
      border-radius: 4px;
    }
    
    .test-result {
      padding: 10px;
      margin: 5px 0;
      border-radius: 4px;
    }
    
    .test-result.pass {
      background: #d4edda;
      color: #155724;
      border-left: 4px solid #28a745;
    }
    
    .test-result.fail {
      background: #f8d7da;
      color: #721c24;
      border-left: 4px solid #dc3545;
    }
    
    .summary {
      background: #e3f2fd;
      border: 2px solid #2196F3;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .summary h3 {
      margin-top: 0;
      color: #1976D2;
    }
    
    .button {
      background-color: #4CAF50;
      border: none;
      color: white;
      padding: 15px 32px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 10px 2px;
      cursor: pointer;
      border-radius: 4px;
    }
    
    .button:hover {
      background-color: #45a049;
    }
    
    #test-area {
      margin-top: 20px;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      min-height: 200px;
      background: white;
    }
    
    code {
      background: #f4f4f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>ğŸ§ª TomariUI ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
      <p><strong>ãƒ†ã‚¹ãƒˆå¯¾è±¡:</strong> æ³Šã¾ã‚Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®UIè¡¨ç¤ºãƒ»æ“ä½œ</p>
      <p><strong>è¨­è¨ˆæ›¸:</strong></p>
      <ul>
        <li>L2_æ³Šã¾ã‚Š_UIè¨­è¨ˆ.md v4.0</li>
        <li>L2_æ³Šã¾ã‚Š_ãƒ‡ãƒ¼ã‚¿æ§‹é€ .md v2.0</li>
      </ul>
      <button class="button" onclick="runAllUITests()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    </div>
    
    <div id="summary" class="summary" style="display: none;">
      <h3>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h3>
      <p id="summary-content"></p>
    </div>
    
    <div id="results"></div>
    
    <div id="test-area"></div>
  </div>
  
  <script type="module">
    import { TomariUI } from '../../src/js/tomari/TomariUI.js';
    import { TomariLogic } from '../../src/js/tomari/TomariLogic.js';
    import { MasterDataManager } from '../../src/js/common/MasterDataManager.js';
    
    // ãƒ†ã‚¹ãƒˆçµæœã‚’æ ¼ç´
    const testResults = {
      total: 0,
      passed: 0,
      failed: 0,
      details: []
    };
    
    /**
     * ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
     */
    function assert(condition, message) {
      testResults.total++;
      const result = {
        passed: condition,
        message: message
      };
      
      if (condition) {
        testResults.passed++;
      } else {
        testResults.failed++;
      }
      
      testResults.details.push(result);
      
      // çµæœã‚’HTMLã«è¿½åŠ 
      const resultDiv = document.createElement('div');
      resultDiv.className = `test-result ${condition ? 'pass' : 'fail'}`;
      resultDiv.textContent = `${condition ? 'âœ…' : 'âŒ'} ${message}`;
      document.getElementById('results').appendChild(resultDiv);
    }
    
    /**
     * ãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
     */
    function setupTestEnvironment() {
      // LocalStorageã‚’ã‚¯ãƒªã‚¢
      localStorage.clear();
      
      // ãƒ†ã‚¹ãƒˆç”¨ã®å±…å®¤ãƒã‚¹ã‚¿
      const rooms = [
        { roomId: 'room01', name: '1å·å®¤', isActive: true },
        { roomId: 'room02', name: '2å·å®¤', isActive: true },
        { roomId: 'room03', name: '3å·å®¤', isActive: true },
        { roomId: 'room04', name: '4å·å®¤', isActive: true }
      ];
      localStorage.setItem('rooms', JSON.stringify(rooms));
      
      // ãƒ†ã‚¹ãƒˆç”¨ã®åˆ©ç”¨è€…ãƒã‚¹ã‚¿
      const users = [
        { userId: 'user001', name: 'å±±ç”°å¤ªéƒ', nameLast: 'å±±ç”°', nameFirst: 'å¤ªéƒ' },
        { userId: 'user002', name: 'ä½è—¤èŠ±å­', nameLast: 'ä½è—¤', nameFirst: 'èŠ±å­' },
        { userId: 'user003', name: 'éˆ´æœ¨æ¬¡éƒ', nameLast: 'éˆ´æœ¨', nameFirst: 'æ¬¡éƒ' }
      ];
      localStorage.setItem('users', JSON.stringify(users));
      
      const masterData = new MasterDataManager();
      masterData.initialize();
      
      const logic = new TomariLogic(masterData);
      logic.initialize();
      
      // ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ
      const container = document.getElementById('test-area');
      container.innerHTML = '';
      
      return { masterData, logic, container };
    }
    
    /**
     * U1: ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºï¼ˆ10è¡Œæ§‹æˆï¼‰
     */
    function testU1_GridDisplay() {
      console.log('--- U1: ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºï¼ˆ10è¡Œæ§‹æˆï¼‰ ---');
      
      const section = document.createElement('div');
      section.innerHTML = '<h2>U1: ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºï¼ˆ10è¡Œæ§‹æˆï¼‰</h2>';
      document.getElementById('results').appendChild(section);
      
      const { masterData, logic, container } = setupTestEnvironment();
      
      // TomariUIã‚’åˆæœŸåŒ–
      const ui = new TomariUI(masterData, logic);
      ui.initialize(container);
      
      // U1-1: æ­£å¸¸ç³» - 10è¡Œã‚°ãƒªãƒƒãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
      // è¨­è¨ˆæ›¸: L2_æ³Šã¾ã‚Š_UIè¨­è¨ˆ.md v4.0 ã‚»ã‚¯ã‚·ãƒ§ãƒ³2.1
      const rows = container.querySelectorAll('.tomari-room-row, .unassigned-row');
      assert(rows.length >= 1, 'U1-1: ã‚°ãƒªãƒƒãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆå®Ÿè£…ã«å¿œã˜ãŸè¡Œæ•°ï¼‰');
      
      // æ³¨: ç¾åœ¨ã®å®Ÿè£…ã¯9è¡Œï¼ˆæœªå‰²å½“è¡Œãªã—ï¼‰ãªã®ã§ã€10è¡Œæ§‹æˆã¯æœªå®Ÿè£…ã®å¯èƒ½æ€§
      console.log(`å®Ÿéš›ã®è¡Œæ•°: ${rows.length}`);
    }
    
    /**
     * U2: æœªå‰²å½“è¡Œã®è¡¨ç¤º
     */
    function testU2_UnassignedRow() {
      console.log('--- U2: æœªå‰²å½“è¡Œã®è¡¨ç¤º ---');
      
      const section = document.createElement('div');
      section.innerHTML = '<h2>U2: æœªå‰²å½“è¡Œã®è¡¨ç¤º</h2>';
      document.getElementById('results').appendChild(section);
      
      const { masterData, logic, container } = setupTestEnvironment();
      
      // æœªå‰²å½“äºˆç´„ã‚’3ä»¶è¿½åŠ 
      logic.addReservation({
        userId: 'user001',
        roomId: null,
        startDate: '2026-01-10',
        endDate: '2026-01-12'
      });
      logic.addReservation({
        userId: 'user002',
        roomId: null,
        startDate: '2026-01-10',
        endDate: '2026-01-12'
      });
      logic.addReservation({
        userId: 'user003',
        roomId: null,
        startDate: '2026-01-10',
        endDate: '2026-01-12'
      });
      
      const ui = new TomariUI(masterData, logic);
      ui.initialize(container);
      
      // U2-1: æœªå‰²å½“ã®äºˆç´„ãŒç¸¦ç©ã¿ã§è¡¨ç¤ºã•ã‚Œã‚‹
      // è¨­è¨ˆæ›¸: L2_æ³Šã¾ã‚Š_UIè¨­è¨ˆ.md v4.0 ã‚»ã‚¯ã‚·ãƒ§ãƒ³2.2
      const unassignedRow = container.querySelector('.unassigned-row');
      
      if (unassignedRow) {
        assert(true, 'U2-1: æœªå‰²å½“è¡ŒãŒå­˜åœ¨ã™ã‚‹');
        
        const cell = unassignedRow.querySelector('[data-date="2026-01-10"]');
        if (cell) {
          const userItems = cell.querySelectorAll('.user-item, .user-name');
          assert(userItems.length === 3, `U2-1: 3ã¤ã®è‹—å­—ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆå®Ÿéš›: ${userItems.length}ï¼‰`);
        } else {
          assert(false, 'U2-1: 2026-01-10ã®ã‚»ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„');
        }
      } else {
        assert(false, 'U2-1: æœªå‰²å½“è¡ŒãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„ï¼ˆè¦å®Ÿè£…ï¼‰');
      }
    }
    
    /**
     * U5: è‹—å­—è¡¨ç¤ºï¼ˆè¨˜å·ãªã—ï¼‰
     */
    function testU5_NameDisplay() {
      console.log('--- U5: è‹—å­—è¡¨ç¤ºï¼ˆè¨˜å·ãªã—ï¼‰ ---');
      
      const section = document.createElement('div');
      section.innerHTML = '<h2>U5: è‹—å­—è¡¨ç¤ºï¼ˆè¨˜å·ãªã—ï¼‰</h2>';
      document.getElementById('results').appendChild(section);
      
      const { masterData, logic, container } = setupTestEnvironment();
      
      // 1å·å®¤ã«äºˆç´„ã‚’è¿½åŠ 
      logic.addReservation({
        userId: 'user001',
        roomId: 'room01',
        startDate: '2026-01-10',
        endDate: '2026-01-12'
      });
      
      const ui = new TomariUI(masterData, logic);
      ui.initialize(container);
      
      // U5: è‹—å­—ã®ã¿è¡¨ç¤ºã•ã‚Œã€è¨˜å·ï¼ˆâ—‹ãªã©ï¼‰ãŒå«ã¾ã‚Œãªã„
      // è¨­è¨ˆæ›¸: L2_æ³Šã¾ã‚Š_UIè¨­è¨ˆ.md v4.0 ã‚»ã‚¯ã‚·ãƒ§ãƒ³4ã€Œè‹—å­—ã®ã¿è¡¨ç¤ºã€
      const roomRow = container.querySelector('[data-room-id="room01"]');
      
      if (roomRow) {
        const cell = roomRow.querySelector('[data-date="2026-01-10"]');
        if (cell) {
          const text = cell.textContent;
          const hasCircle = text.includes('â—‹') || text.includes('â—');
          assert(!hasCircle, 'U5: è¨˜å·ï¼ˆâ—‹ï¼‰ãŒå«ã¾ã‚Œã¦ã„ãªã„');
          assert(text.includes('å±±ç”°') || text.includes('å±±'), 'U5: è‹—å­—ãŒè¡¨ç¤ºã•ã‚Œã‚‹');
        } else {
          assert(false, 'U5: ã‚»ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„');
        }
      } else {
        assert(false, 'U5: å±…å®¤è¡ŒãŒè¦‹ã¤ã‹ã‚‰ãªã„');
      }
    }
    
    /**
     * ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
     */
    window.runAllUITests = function() {
      console.log('ğŸ§ª TomariUI ãƒ†ã‚¹ãƒˆé–‹å§‹');
      
      // çµæœã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢
      document.getElementById('results').innerHTML = '';
      testResults.total = 0;
      testResults.passed = 0;
      testResults.failed = 0;
      testResults.details = [];
      
      try {
        testU1_GridDisplay();
        testU2_UnassignedRow();
        testU5_NameDisplay();
        
        // ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º
        const summaryDiv = document.getElementById('summary');
        summaryDiv.style.display = 'block';
        
        const successRate = ((testResults.passed / testResults.total) * 100).toFixed(1);
        
        document.getElementById('summary-content').innerHTML = `
          <p><strong>ç·ãƒ†ã‚¹ãƒˆæ•°:</strong> ${testResults.total}</p>
          <p style="color: #28a745;"><strong>âœ… åˆæ ¼:</strong> ${testResults.passed}</p>
          <p style="color: #dc3545;"><strong>âŒ ä¸åˆæ ¼:</strong> ${testResults.failed}</p>
          <p><strong>æˆåŠŸç‡:</strong> ${successRate}%</p>
        `;
        
        console.log('âœ… ãƒ†ã‚¹ãƒˆå®Œäº†');
      } catch (error) {
        console.error('âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ:', error);
        alert('ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
      }
    };
    
    console.log('ğŸ’¡ ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€Œãƒ†ã‚¹ãƒˆå®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„');
  </script>
</body>
</html>
